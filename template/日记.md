<%* 
let weatherUrl = 'https://restapi.amap.com/v3/weather/weatherInfo'
let key = 'c7bd112912675afcbe79058c0e5a2f8f'

let tencentIpUrl = 'https://apis.map.qq.com/ws/location/v1/ip';
let tencentKey = 'TOFBZ-7GC6U-SA7VD-GBHTA-BRPD7-2YFZS'

let ipResult = eval("(" + await request({url: tencentIpUrl + `?key=${tencentKey}`, method: "GET"}) + ")").result
console.log("ipResult: ", ipResult)

let adcode = ipResult.ad_info.adcode
console.log("adcode: " + adcode)

let 位置 = ''
let 天气 = ''
let 温度 = ''
let 风向 = ''
await fetch(weatherUrl + `?key=${key}&city=${adcode}&extensions=all`)
.then(res => res.json())
.then((data) => {
	let info = data.forecasts[0]
	
	console.log("info:" + info)
	
	位置 = info.province + '-' + info.city
	天气 = 'Day ' + info.casts[0].dayweather + ' / Night ' + info.casts[0].nightweather
	温度 = 'Day ' + info.casts[0].daytemp_float + '℃' + ' / Night ' + info.casts[0].nighttemp_float + '℃'
})
-%>
---
日期: <% tp.file.creation_date("YYYY MM DD HH:mm:ss") %>
星期: <% tp.file.creation_date("dddd") %>
时间: <% tp.file.creation_date("HH:mm:ss") %>
位置: <% 位置 %>
天气: <% 天气 %>
温度: <% 温度 %>
tags:
- task
- diary
---
<%*
let 一言 = ""
let 来源 = ""
let 作者 = ""

await fetch('https://v1.hitokoto.cn/?c=d&c=h&c=i&c=j')
.then(response => response.json())
.then(data => { 
	一言 = data.hitokoto
	来源 = data.from
	作者 = data.from_who === null ? '佚名' : data.from_who
})
-%>
>[!quote] 一言
 <% 一言 %>  —— 《<% 来源 %>》 · <% 作者 %>

```dataviewjs
try{
	const today = new Date(dv.current().file.name);
	const yesterday = new Date(today);
	yesterday.setDate(yesterday.getDate() - 1);
	const getUpTime = dv.page(today.toISOString().split('T')[0]).getup;
	const sleepTime = dv.page(yesterday.toISOString().split('T')[0]).sleep;
	const getUpDateTime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), ...getUpTime.split(':').map(Number));
	const sleepDateTime = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), ...sleepTime.split(':').map(Number));
	const diff = getUpDateTime.getTime() - sleepDateTime.getTime();
	const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
	const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
	dv.paragraph(`今天的==睡眠==时间为: **${hours}**小时**${minutes}**分钟`);
}catch (error){
	dv.paragraph("昨天的记录没有了。")
}
```
---
# 今日计划

`ris:SunCloudy`**早** 起床 (getup:: fill this)
- [ ] (8:30~9:00)   简短复习 📅 <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (9:00~10:30)  高数习题 📅 <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (10:30~11:00) 单词一 📅 <% tp.date.now("YYYY-MM-DD") %> 
---
`fas:Sun`**午** 饭点 (lunch:: fill this)
- [ ] (13:00~15:00) 线代基础 📅 <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (15:00~15:30) 单词二 📅 <% tp.date.now("YYYY-MM-DD") %> 
---
`fas:Moon`**晚** 晚饭 (dinner:: fill this)
- [ ] (18:30~20:00) 数据结构 📅 <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (20:00~21:00) 计算机组成原理 📅 <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (21:00~21:30) 单词三 📅 <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (21:30~22:00) 自由复习 📅 <% tp.date.now("YYYY-MM-DD") %> 
---
`ris:Zzz` (sleep:: fill this)

```dataviewjs
dv.paragraph("## 今日统计")

const path = dv.current().file.path;
const file = app.vault.getAbstractFileByPath(path);
const content = await app.vault.cachedRead(file);

const regex = /- \[x\]\s*(~~)?\((\d{1,2}:\d{2}~\d{1,2}:\d{2})\)(~~)?/g;

let match;
const timeRanges = [];
let totalTimeNormal = 0;
let totalTimeStrikethrough = 0;

// 使用正则表达式匹配时间段
while ((match = regex.exec(content)) !== null) {
    const isStrikethrough = !!(match[1] && match[3]);
    const timeRange = match[2].split('~');
    const startTime = timeRange[0];
    const endTime = timeRange[1];
    
    const start = new Date(`1970-01-01 ${startTime}`);
    const end = new Date(`1970-01-01 ${endTime}`);
    const duration = (end - start) / 60000; // 转换为分钟

    if (isStrikethrough) {
        totalTimeStrikethrough += duration;
    } else {
        totalTimeNormal += duration;
    }

    timeRanges.push({
        startTime: startTime,
        endTime: endTime,
        duration: duration,
        isStrikethrough: isStrikethrough,
    });
}

// 计算总时间
const totalDuration = totalTimeNormal + totalTimeStrikethrough;

// 创建表格
let table = `<table>
<tr>
    <th>StartTime</th>
    <th>EndTime</th>
    <th>Duration(min)</th>
    <th>Percentage(%)</th>
</tr>`;

timeRanges.forEach(range => {
    const percentage = ((range.duration / totalDuration) * 100).toFixed(1);
	if(range.isStrikethrough){
	    table += `<tr>
	        <td><del>${range.startTime}</del></td>
	        <td><del>${range.endTime}</del></td>
	        <td>${range.duration}</td>
	        <td>${percentage}</td>
	    </tr>`;
	}else{
	    table += `<tr>
	        <td>${range.startTime}</td>
	        <td>${range.endTime}</td>
	        <td>${range.duration}</td>
	        <td>${percentage}</td>
	    </tr>`;
	}
});

table += `</table>`;

// 将分钟转换为 HH:MM 格式
function formatMinutesToHHMM(minutes) {
    const hours = Math.floor(minutes / 60);
    const mins = Math.floor(minutes % 60);
	if(hours == 0){
	    return `${mins.toString().padStart(2, '0')}min`;
	}else{
	    return `${hours.toString()}h${mins.toString().padStart(2, '0')}min`;
	}
}

// 插入表格到页面
dv.el('div', table, { cls: 'time-ranges-table' });

// 显示总和时间
const summary = `- 今日学习时间: ${formatMinutesToHHMM(totalTimeNormal)}
- 处理杂项时间: ${formatMinutesToHHMM(totalTimeStrikethrough)}
- 统计总时间: ${formatMinutesToHHMM(totalDuration)}`;

dv.el('div', summary, { cls: 'time-ranges-summary' });
dv.paragraph(
`- 今天统计了 ${formatMinutesToHHMM(totalDuration)}, \
其中 ${parseInt(totalTimeNormal/totalDuration * 100)}% 时间用在了学习上!` 
)
```

## 遗留待办

```dataview
TASK
WHERE all([contains(file.tags, "task"), !fullyCompleted, due < date(<% tp.date.now("YYYY-MM-DD") %>)])
```

# 总结

今天想要说什么？


---
<< [[<% tp.date.now("YYYY-MM-DD", -1) %>]] | [[<% tp.date.now("YYYY-MM-DD", 1) %>]] >>
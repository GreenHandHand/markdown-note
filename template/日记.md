<%* 
let weatherUrl = 'https://restapi.amap.com/v3/weather/weatherInfo'
let key = 'c7bd112912675afcbe79058c0e5a2f8f'

let tencentIpUrl = 'https://apis.map.qq.com/ws/location/v1/ip';
let tencentKey = 'TOFBZ-7GC6U-SA7VD-GBHTA-BRPD7-2YFZS'

let ipResult = eval("(" + await request({url: tencentIpUrl + `?key=${tencentKey}`, method: "GET"}) + ")").result
console.log("ipResult: ", ipResult)

let adcode = ipResult.ad_info.adcode
console.log("adcode: " + adcode)

let ä½ç½® = ''
let å¤©æ°” = ''
let æ¸©åº¦ = ''
let é£å‘ = ''
await fetch(weatherUrl + `?key=${key}&city=${adcode}&extensions=all`)
.then(res => res.json())
.then((data) => {
	let info = data.forecasts[0]
	
	console.log("info:" + info)
	
	ä½ç½® = info.province + '-' + info.city
	å¤©æ°” = 'Day ' + info.casts[0].dayweather + ' / Night ' + info.casts[0].nightweather
	æ¸©åº¦ = 'Day ' + info.casts[0].daytemp_float + 'â„ƒ' + ' / Night ' + info.casts[0].nighttemp_float + 'â„ƒ'
})
-%>
---
æ—¥æœŸ: <% tp.file.creation_date("YYYY MM DD HH:mm:ss") %>
æ˜ŸæœŸ: <% tp.file.creation_date("dddd") %>
æ—¶é—´: <% tp.file.creation_date("HH:mm:ss") %>
ä½ç½®: <% ä½ç½® %>
å¤©æ°”: <% å¤©æ°” %>
æ¸©åº¦: <% æ¸©åº¦ %>
tags:
- task
- diary
---
<%*
let ä¸€è¨€ = ""
let æ¥æº = ""
let ä½œè€… = ""

await fetch('https://v1.hitokoto.cn/?c=d&c=h&c=i&c=j')
.then(response => response.json())
.then(data => { 
	ä¸€è¨€ = data.hitokoto
	æ¥æº = data.from
	ä½œè€… = data.from_who === null ? 'ä½šå' : data.from_who
})
-%>
>[!quote] ä¸€è¨€
 <% ä¸€è¨€ %>  â€”â€” ã€Š<% æ¥æº %>ã€‹ Â· <% ä½œè€… %>

```dataviewjs
try{
	const today = new Date(dv.current().file.name);
	const yesterday = new Date(today);
	yesterday.setDate(yesterday.getDate() - 1);
	const getUpTime = dv.page(today.toISOString().split('T')[0]).getup;
	const sleepTime = dv.page(yesterday.toISOString().split('T')[0]).sleep;
	const getUpDateTime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), ...getUpTime.split(':').map(Number));
	const sleepDateTime = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), ...sleepTime.split(':').map(Number));
	const diff = getUpDateTime.getTime() - sleepDateTime.getTime();
	const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
	const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
	dv.paragraph(`ä»Šå¤©çš„==ç¡çœ ==æ—¶é—´ä¸º: **${hours}**å°æ—¶**${minutes}**åˆ†é’Ÿ`);
}catch (error){
	dv.paragraph("æ˜¨å¤©çš„è®°å½•æ²¡æœ‰äº†ã€‚")
}
```
---
# ä»Šæ—¥è®¡åˆ’

`ris:SunCloudy`**æ—©** èµ·åºŠ (getup:: fill this)
- [ ] (8:30~9:00)   ç®€çŸ­å¤ä¹  ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (9:00~10:30)  é«˜æ•°ä¹ é¢˜ ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (10:30~11:00) å•è¯ä¸€ ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
---
`fas:Sun`**åˆ** é¥­ç‚¹ (lunch:: fill this)
- [ ] (13:00~15:00) çº¿ä»£åŸºç¡€ ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (15:00~15:30) å•è¯äºŒ ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
---
`fas:Moon`**æ™š** æ™šé¥­ (dinner:: fill this)
- [ ] (18:30~20:00) æ•°æ®ç»“æ„ ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (20:00~21:00) è®¡ç®—æœºç»„æˆåŸç† ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (21:00~21:30) å•è¯ä¸‰ ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
- [ ] (21:30~22:00) è‡ªç”±å¤ä¹  ğŸ“… <% tp.date.now("YYYY-MM-DD") %> 
---
`ris:Zzz` (sleep:: fill this)

```dataviewjs
dv.paragraph("## ä»Šæ—¥ç»Ÿè®¡")

const path = dv.current().file.path;
const file = app.vault.getAbstractFileByPath(path);
const content = await app.vault.cachedRead(file);

const regex = /- \[x\]\s*(~~)?\((\d{1,2}:\d{2}~\d{1,2}:\d{2})\)(~~)?/g;

let match;
const timeRanges = [];
let totalTimeNormal = 0;
let totalTimeStrikethrough = 0;

// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ—¶é—´æ®µ
while ((match = regex.exec(content)) !== null) {
    const isStrikethrough = !!(match[1] && match[3]);
    const timeRange = match[2].split('~');
    const startTime = timeRange[0];
    const endTime = timeRange[1];
    
    const start = new Date(`1970-01-01 ${startTime}`);
    const end = new Date(`1970-01-01 ${endTime}`);
    const duration = (end - start) / 60000; // è½¬æ¢ä¸ºåˆ†é’Ÿ

    if (isStrikethrough) {
        totalTimeStrikethrough += duration;
    } else {
        totalTimeNormal += duration;
    }

    timeRanges.push({
        startTime: startTime,
        endTime: endTime,
        duration: duration,
        isStrikethrough: isStrikethrough,
    });
}

// è®¡ç®—æ€»æ—¶é—´
const totalDuration = totalTimeNormal + totalTimeStrikethrough;

// åˆ›å»ºè¡¨æ ¼
let table = `<table>
<tr>
    <th>StartTime</th>
    <th>EndTime</th>
    <th>Duration(min)</th>
    <th>Percentage(%)</th>
</tr>`;

timeRanges.forEach(range => {
    const percentage = ((range.duration / totalDuration) * 100).toFixed(1);
	if(range.isStrikethrough){
	    table += `<tr>
	        <td><del>${range.startTime}</del></td>
	        <td><del>${range.endTime}</del></td>
	        <td>${range.duration}</td>
	        <td>${percentage}</td>
	    </tr>`;
	}else{
	    table += `<tr>
	        <td>${range.startTime}</td>
	        <td>${range.endTime}</td>
	        <td>${range.duration}</td>
	        <td>${percentage}</td>
	    </tr>`;
	}
});

table += `</table>`;

// å°†åˆ†é’Ÿè½¬æ¢ä¸º HH:MM æ ¼å¼
function formatMinutesToHHMM(minutes) {
    const hours = Math.floor(minutes / 60);
    const mins = Math.floor(minutes % 60);
	if(hours == 0){
	    return `${mins.toString().padStart(2, '0')}min`;
	}else{
	    return `${hours.toString()}h${mins.toString().padStart(2, '0')}min`;
	}
}

// æ’å…¥è¡¨æ ¼åˆ°é¡µé¢
dv.el('div', table, { cls: 'time-ranges-table' });

// æ˜¾ç¤ºæ€»å’Œæ—¶é—´
const summary = `- ä»Šæ—¥å­¦ä¹ æ—¶é—´: ${formatMinutesToHHMM(totalTimeNormal)}
- å¤„ç†æ‚é¡¹æ—¶é—´: ${formatMinutesToHHMM(totalTimeStrikethrough)}
- ç»Ÿè®¡æ€»æ—¶é—´: ${formatMinutesToHHMM(totalDuration)}`;

dv.el('div', summary, { cls: 'time-ranges-summary' });
dv.paragraph(
`- ä»Šå¤©ç»Ÿè®¡äº† ${formatMinutesToHHMM(totalDuration)}, \
å…¶ä¸­ ${parseInt(totalTimeNormal/totalDuration * 100)}% æ—¶é—´ç”¨åœ¨äº†å­¦ä¹ ä¸Š!` 
)
```

## é—ç•™å¾…åŠ

```dataview
TASK
WHERE all([contains(file.tags, "task"), !fullyCompleted, due < date(<% tp.date.now("YYYY-MM-DD") %>)])
```

# æ€»ç»“

ä»Šå¤©æƒ³è¦è¯´ä»€ä¹ˆï¼Ÿ


---
<< [[<% tp.date.now("YYYY-MM-DD", -1) %>]] | [[<% tp.date.now("YYYY-MM-DD", 1) %>]] >>
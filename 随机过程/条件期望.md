# 条件期望

条件数学期望是随机数学中最基本最重要的概念之一，它在 [[随机过程]] 中有着广泛的应用。

## 离散情况

概率论中，对于任意两个事件 $E$ 和 $F$，当 $P(E)>0$ 且给定 $F$ 时，$E$ 的条件概率定义为
$$
P(E|F)=\frac{P(EF)}{P(F)}
$$
在离散情况下，可以将给定条件 $Y=y$ 的条件下 $X$ 的条件概率质量函数定义为
$$
p_{X|Y}(x|y)=P\{X=x|Y=y\}=\frac{P(X=x,Y=y)}{P(Y=y)}=\frac{p(x,y)}{p_Y(y)}
$$
于是 $X$ 的条件分布函数定义为
$$
F_{X|Y}(x|y)=P\{X\leqslant x|Y=y\}=\sum_{a\leqslant x}p_{X|Y}(a|y)
$$
最后，在 $Y=y$ 给定条件下，$X$ 的条件期望定义为
$$
E[X|Y=y]=\sum_xxP\{X=x|Y=y\}=\sum_xxp_{X|Y}(x|y)
$$
## 连续情况

如果 $X$ 和 $Y$ 有联合密度函数 $f(x,y)$，那么对于所有 $f_Y(y)>0$ 的 $y$ 值，给定 $Y=y$ 时 $X$ 的条件概率密度函数定义为
$$
f_{X|Y}=\frac{f(x,y)}{f_Y(y)}
$$
于是对于所有的 $f_Y(y)>0$ 的 $y$ 值，给定 $Y=y$ 时 $X$ 的条件期望定义为
$$
E[X|Y=y]=\int_{-\infty}^{\infty}xf_{X|Y}(x|y)\mathrm dx
$$

## 条件期望的性质

我们使用条件期望是因为条件期望有以下非常重要的性质：
1. $E[X]=E[E[X|Y]]$，即对条件概率求期望可以得到期望
2. $E[\sum_{i=1}^n\alpha_iX_i|Y]=\sum_{i=1}^n\alpha_iE[X_i|Y]$，其中 $\alpha_i$ 为常数
3. $E[g(X)h(Y)|Y]=h(Y)E[g(X)|Y]$，即条件期望中的条件可以视为常数
4. $E[g(X)h(Y)]=E[h(Y)E[g(X)|Y]]$，即可以将期望中的数字变为条件期望
5. 如果 $X,Y$ 独立，则 $E[X|Y]=E[X]$

## 应用

下面介绍条件期望的运用。

### 通过取条件计算期望

由于
$$
E[X]=E\Big[E[X|Y]\Big]
$$
当 $Y$ 是
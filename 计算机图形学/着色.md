---
tags:
  - 计算机图形学
---

# 着色

 着色 (*Shading*) 在计算机图形学中表示为片元添加纹理与材质 (*materials*) 的过程。

> [!note]
> shading 与 shadow 不同，shading 虽然会为物体添加上明暗细节，但是不会添加阴影。具体来说，shading 不会考虑不同物体之间的相互作用，只会考虑物体与光源的相互作用。

## Blinn-Phong 反射模型

Blinn-Phong 反射模型 (Blinn-Phong Reflectance Model) 是一个效果不错的经验模型。在该模型中，我们将光线抽象为以下五大要素：
1. 着色点 (Shading point)：对于每一个平面，我们将其抽象为一系列 Shading point 的集合。
2. 观察方向 (View direction)：观察者所在的方向，使用方向向量 $\vec{v}$ 表示。
3. 法线方向 (Surface normal)：平面的法线方向，使用方向向量 $\vec{n}$ 表示。
4. 光照方向 (Light direction)：光照方向，使用方向向量 $\vec{l}$ 表示。
5. 表面参数 (Surface parameter)：照射平面的各种参数，例如颜色、粗糙程度等。

> [!example]-
> ![[image/着色.png]]

通过观察现实世界中的光照，我们可以简单的认为一个物体的光照由下面三种光照组成：
- 漫反射 (*Diffuse reflection*)
- 镜面反射、高光 (*Specular highlight*)
- 环境光 (*Ambient lighting*)

### 漫反射

从一个简单的例子开始，对于一个粗糙的物体，我们从任何角度观察都不会改变这个物体的颜色。但是对于物体的不同位置，颜色的明暗程度却有所区别。

产生上述现象的原因，是因为对于一个现实中的物体，它的表面总是凹凸不平的。因此光照射到该物体表面时，在任意的方向上都会有反射的光。但是由于物体表面相对于光源的角度不同，导致接收到的光照面积不同，因此造成了明暗区别。

因此，我们将其进行简单的抽象，认为一个光照射到 Shading Point 上时，在任意方向上都会产生一个漫反射光照。而接收的光照数量，我们使用光照强度来表示。

> [!info] 光照强度
> 光照强度是物理学中用于描述光照强弱和物体表面积被照射程度的量。光照强度的定义是单位面积上所接收的光通量的大小，简称为照度。照度的大小取决于光源的发光强度，以及被照体与光源之间的距离，呈现平方反比的规律。
> $$
> I_{r} = k\dfrac{I}{r^{2}}
> $$

> [!note] 朗伯余弦定理
> 朗伯余弦定理 (Lambert’s cosine law) 定量描述了角度与光照强度的关系。
>
> ![[image/着色-1.png]]
>
> 1. 当垂直照射时，平面会接收到照度 $I$ 的光照。
> 2. 当入射角度为 60° 时，平面会接收到照度 $0.5I$ 的光照。
> 3. 一般而言，当入射角度为 $\theta$ 时，每单位面积接收到的照度 $I$ 满足关系：$I\cos \theta=\vec{I}\cdot \vec{n}$

根据朗伯余弦定理，我们可以得到下面的经验公式：
$$
L_{d}=k_{d}(I/r^{2})\max(0, \mathbf{n}\cdot \mathbf{l})
$$
其中：
- $k_{d}$ 表示漫反射系数。对于灰度图，使用标量，越大的漫反射系数越明亮。对于彩色图像，通常使用一个三维向量，表示 RGB 三种颜色的漫反射系数，通过不同的组合可以使得物体呈现出不同的颜色。
- $I/r^{2}$ 表示光照强度，其中 $I$ 是光源发出的光照强度，$r$ 是 Shading Point 与光源的距离。对于多个光源，求和即可。
- $\vec{n}\cdot \vec{l}$ 就是余弦角度，其中 $\vec{n}$ 时法线向量，$\vec{l}$ 是入射方向向量，当余弦角度为正的时候，根据朗伯余弦定理，光照强度与夹角的余弦成正比。当余弦角度为负时，我们认为此时物体背朝光源，因此没有光线照射到物体上，不存在漫反射。
- 从上述公式可以看出，漫反射与观察方向无关，只有数值大小。

### 镜面反射

也从一个例子开始：当我们看向光滑的物体时，根据我们观察的角度不同，物体上会出现一个非常亮的小点，这就是镜面反射导致的高光。

我们在中学时学习过镜面反射相关的知识，当光线照射到镜面上时，会沿着相同的角度反射，即「入射角等于出射角」。高光的形成原因就是在这一片区域上的光线通过镜面反射后，正好反射到了观察者的方向。由于镜面反射对于光照强度的损耗较小，因此出现了一个局部亮度远高于其他区域的高光。

因此，在 Blinn-Phong 反射模型中，我们认为，当观察方向距离镜面反射的出射光越近时，我们观察到的高光越明显。

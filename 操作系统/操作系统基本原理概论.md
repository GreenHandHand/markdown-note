---
aliases:
  - operator system
  - os
tags:
  - 操作系统
  - 概述
---


# 操作系统基本原理概论

## 操作系统的特征

### 并发

并发指两个或者多个时间在同一时间间隔内发生，这些时间在**宏观上是同时发生的**，但是在**微观上是交替发生的**。与并发相近的概念还有并行，但是并行是指两个或者多个事件在同一时刻同时发生。

操作系统的并发性指计算机系统中同时运行着多个程序，这些程序在宏观上是同时运行着的，而微观上看是交替运行的。实现操作系统并发性的一个重要的方式是通过 [[进程管理]]。

> 从并行与并发的定义可以看出：
> 1. 对于单核 cpu，同一时刻只能执行一个程序，多个程序只能并发的执行。
> 2. 对于多核的 cpu，同一时刻可以同时执行多个程序，即多个程序可以并行的执行。每个程序在不同的核心上同时执行。

### 共享

共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。资源有两种共享方式：
- 互斥共享方式：系统中的某些资源，虽然可以提供给多个进程使用，但是一个时间段内只允许一个进程访问该资源。
- 同时共享方式：系统中的某些资源，允许同一时间段内由多个进程同时对它们进行访问。

需要注意的是，对于同时共享方式，这个同时一般是在宏观上的，即并发的，而在微观上仍然是交替的访问资源。互斥共享的一个典型的例子是 IO 设备，同时共享的一个典型的例子是访问磁盘。

共享性指的系统中的资源可供内存中的多个进程并发的访问，因此共享性是建立在并发性之上的。

### 虚拟

虚拟指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上对应物（后者）是用户感受到的。

虚拟技术主要有两种：
- 空分复用技术（如存储器）
- 时分复用技术

### 异步性

异步指在多道程序环境下，运行多个程序并发执行，但是由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进。

由于并发运行的程序会争抢着使用系统资源，而系统中的资源有限，因此进程的执行不是一贯到底的，可能由于其他的进程被阻塞。

进程以不可预知的速度向前推进。何时执行、何时暂停、何时完成都是未知的，这就造成了系统的异步性。同样，异步性建立在并发性的基础上的。

## 操作系统的发展

### 手工操作阶段

程序员通过在纸带上打孔的方式编写程序，计算机通过读取纸带的方式运行程序，并将输出结果也打印到纸带上得到运行的结果。

程序员编写程序、将程序输入计算机花费的时间很长，但是计算机计算的时间却很短。这个阶段的主要缺点是用户独占全机，人机速度矛盾导致资源利用率极低。

### 单道批处理系统

引入了脱机输入、输出技术（使用外围机+磁带完成），并用监督程序负责控制作业的输入、输出。

相比于手工操作阶段，单道批处理系统缓解了一定程度的人机速度矛盾，资源利用率有所提升。但是内存中仅能有一道程序运行，只有该程序运行结束后才能调用下一道程序，CPU 有大量的时间是在等待 IO 完成，资源利用率仍然很低。

### 多道批处理系统

每次向内存中读入多道程序，并且每道程序并发运行。这个时候，操作系统的概念正式诞生。

多道程序并发执行，共享计算机资源。资源利用率大幅提升，CPU 和其他资源更能保持忙碌的状态，系统吞吐量增大。

但是多道批处理系统中，用户的响应时间长，没有人机交互功能，用户提交了自己的作业后只能等待计算机处理完成，中间不能控制自己的作业执行。

### 分式操作系统

在分时操作系统中，计算机以时间片为单位轮流为各个用户、作业服务，各个用户可以通过终端与计算机交互。

用户的请求可以被即使响应，解决了人机交互的问题，运行多个用户同时使用一台计算机，并且用户对计算机的操作独立，感受不到其他人的存在。

分式操作系统的设计导致了不能优先处理一些紧急任务，操作系统对每个用户、作业都是完全公平的，循环地为每个用户、作业服务一个时间片，不区分任务的紧急性。
### 实时操作系统

在一些特定的情景下，需要优先响应一些紧急任务，因此提出了实时操作系统。实时操作系统能够优先响应一些紧急任务，某些紧急任务不需要时间片排队。

在实时操作系统的控制下，计算机系统接受到外部信号后及时进行处理，并且要在严格的时限内处理完事件，实时操作系统的主要特点是及时性和可靠性。

实时操作系统有分为两种：
1. 硬实时操作系统：必须在绝对严格的规定时间内完成
2. 软实时操作系统：能接受偶尔违反时间

### 其他操作系统

现在还发展出来网络操作系统、分布式操作系统，用于针对不同的情景。

## 操作系统的运行机制

### 内核程序与应用程序

操作系统的程序分为内核程序和应用程序。
- 其中应用程序就是我们平时所见到的软件程序。
- 内核程序是用于实现操作系统的控制功能的程序，很多的内核程序组成了**操作系统内核**，简称为**内核**。内核是操作系统中最核心的部分，也是最接近硬件的部分，甚至可以说，一个操作系统只需要有内核就可以了。

操作系统的内核作为管理者，有时可以让 CPU 执行一些特权指令，例如内存清零指令。这些指令影响重大，只允许操作系统的内核来使用。

### 内核态与用户态

CPU 有两种状态：
- 内核态：处于内核态，说明此时正在运行的是内核程序，此时可以执行特权指令。
- 用户态：处于用户态时，说明此时正在运行的是应用程序，此时只能执行非特权指令。

在 CPU 中，有一个寄存器叫做程序状态字寄存器（PSW），其中有一个二进制位，1 表示内核态，0 表示用户态。用户态也称为目态，内核态也称为核心态或者管态。

内核态与用户态的切换过程一般如下：
- 在内核态切换为用户态时，执行一条特权指令，并修改 PSW 的标志位为用户态，这个动作意味着操作系统将主动让出 CPU 使用权。
- 用户态切换为内核态一般由中断信号触发，硬件自动完成变态过程，触发终端信号意味着操作系统将强行夺回 CPU 的使用权。

### 操作系统的中断

在合适的情况下，操作系统内核会将 CPU 的使用权主动让给应用程序。中断时让操作系统内核夺回 CPU 使用权的唯一途径。中断会使 CPU 由用户态变为内核态，是操作系统重新夺回对 CPU 的控制权。

> 如果没有中断机制，那么一旦应用程序在 CPU 上运行，CPU 就会一直运行这个应用程序

中断分为内中断与外中断：
- 内中断（异常、例外）：若当前执行的指令是非法的，则会引发一个中断信号。或者应用程序执行了陷入指令。

> 应用程序执行陷入指令，意味主动将 CPU 的控制权还给了操作系统内核，系统调用就是通过陷入指令完成的。

- 外中断（中断）：与当前执行的指令无关，中断信号来源于 CPU 外部。例如时钟中断、IO 设备发来的中断信号。

一般我们说的中断指的是狭义的中断，而将内中断称为异常。

### 系统调用

应用程序通过系统调用请求操作系统的服务。系统中的各种共享资源都由操作系统内核统一掌管，因此**凡是与共享资源有关的操作，都必须通过系统调用的方式向操作系统内核提出服务请求**，由操作系统代为完成。这样可以保证系统的稳定性和完整性，防止用户非法操作。

将系统调用按照功能分类，可以分为：
1. 设备管理：完成设备的 请求/释放/启动 等功能。
2. 文件管理：完成文件的 读/写/创建/删除 等功能。
3. 进程控制：完成进程的 创建/撤销/阻塞/唤醒 等功能。
4. 进程通信：完成进程之间的 消息传递/信号传递 等功能。
5. 内存管理：完成内存的 分配/回收 等功能。

系统调用的过程：
1. 当应用程序需要进行系统调用时，需要先执行传参指令，将相关的参数存入寄存器中，接着执行陷入指令，该陷入指令的执行引发了一个内中断，然后cpu就会暂停执行应用程序，转入相应的中断处理程序，即系统调用的入口程序。
2. 系统调用的入口程序显然是需要在内核态进行的程序。该程序将会检查寄存器中的参数，其中第一个参数指明系统调用的类型，还可以由更多的参数用于其他功能。
3. 入口程序选择对应的系统调用执行，其他参数将作为这个系统调用程序的参数输入。
4. 系统调用执行完毕后，cpu转为用户态，交给应用程序计算。

需要注意，陷入指令是在用户态下执行，执行陷入指令后将会引发一个内中断，是cpu进入核心态。发出系统调用请求是在用户态中，而对系统调用的相应处理是在核心态中。

> 陷入指令也可称为trap指令或者访管指令。

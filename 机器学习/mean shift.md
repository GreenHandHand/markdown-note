---
aliases:
  - 核密度估计
  - KDE
  - Kernel density estimation
tag:
  - 机器学习
  - 无监督学习
  - 基本方法
  - 聚类
---

# Mean Shift

Mean Shift 是一种基于核密度估计的[[机器学习/聚类|聚类]]算法。

## 核密度估计

核密度估计 (KDE, Kernel density estimation) 是统计学中的一种密度非参数估计方法，与直方图有密切的关系。

在直方图中，我们通常使用直方图统计数据的分布，但是直方图存在分布曲线不平滑的问题，在每个 bins 中的样本有着相等的概率密度。KDE 是对直方图的一种推广，通过 KDE，我们可以得到连续的概率密度分布曲线。

核密度估计将核平滑应用于概率密度估计，即以核为权重来估计[[概率论与数理统计/一维随机变量及其分布|随机变量]]的概率密度函数。下面给出核密度估计的定义。

设 $(x_1,x_2,\cdots,x_n)$ 是独立同分布样本，则它的核密度估计为
$$
\hat f(x) = \frac{1}{n}\sum_{i=1}^nK_h(x-x_i)=\frac{1}{nh}\sum_{i=1}^nK(\frac{x-x_i}{h})
$$
其中 $K$ 是核函数，$h$ 是一个平滑参数，称为带宽。$K_h$ 称为缩放核，定义为 $K_h(x)=\dfrac{1}{h}K(\dfrac{x}{h})$。

下面给出推导：对于 $N$ 个样本 $(x_1,\cdots,x_n)$，我们希望得到估计他的概率密度分布，根据数据可以得到累计经验分布函数为
$$
F(x)=\frac{1}{N}\sum_{i=1}^NI(x_i<x)
$$
其中 $I$ 为示性函数，满足条件时值为 1。我们希望得到这个累计经验函数的密度函数，就需要这个经验密度函数可导，为了实现这一点，我们需要对这个累计经验函数进行平滑。核密度估计中，使用核函数的方式进行平滑，根据密度函数的定义：
$$
\begin{aligned}
f(x)&=\lim_{h\to 0}\frac{F(x+h)-F(x)}{h}\\
&=\lim_{h\to0}\frac{\sum_{i=1}^N[I(x_i<x+h)-I(x_i<x)]}{Nh}\\
&=\frac{1}{N}\sum_{i=1}^N\lim_{h\to0}\frac{I(x_i-h\leq x<x_i)}{h}
\end{aligned}
$$
当上式中的 $h$ 取一个较大的区间时，我们将得到一个直方图。当 $h\to0$ 时，上式当且仅当 $x=x_i$ 的时候取值为 $\frac{1}{h}$。由于这个极限难以在现实中应用，因此我们希望可以找到它的替代。

我们希望构造一个具有相近性质的函数替代其中的极限。引入 $K(x)$ 满足 $0\leq x \leq 1$ 时有 $\int_0^1 K(x)dx\approx 1$，于是有
$$
\frac{1}{h}K(\frac{\Vert x-x_i\Vert}{h})\approx\lim_{h\to 0}\frac{I(x_i-h\leq x<x_i)}{h}
$$

其中 $h$ 是一个很小的数。对示性函数进行修改，有
$$
f(x)=\frac{1}{N}\sum_{i=1}^N\frac{1}{h}K(\frac{|x-x_i|}{h})
$$
在统计学中，$K$ 被称为核函数。常用的核函数为高斯核。

## Mean Shift

Mean-Shift 算法通过不断调整窗口的位置，使其移向数据分布的高密度区域，从而寻找数据集中的模态。最终，算法将数据点分配到与其最接近的模态相对应的聚类中。其步骤为：
1. 初始化随机种子和窗口 $W$
2. 对于每个点：
	1. 在该点上创建一个窗口
	2. 计算窗口中数据的均值
	3. 将搜索窗口居中到新的位置
	4. 重复这两步直到收敛
3. 将最终聚到一起的点归到一类中

使用数学语言对其进行描述。对于给定的 $d$ 维度空间 $R^d$ 中的 $n$ 个样本点 $x_i$，Mean shift 向量的基本形式为
$$
M_h(x)=\frac{1}{k}\sum_{x_i\in S_h}(x_i-x)
$$
其中 $S_h$ 是一个半径为 $h$ 的高维区域，定义为
$$
S_h(x)=\{y|(y-x)(y-x)^T\leq h^2\}
$$

Mean Shift 向量的基本思路是求解高维区域的球心，并把中心点重新移动到这个球心处。根据核密度估计方法，我们有一个更好的球心求解方式，即
$$
M_h(x)=\frac{\sum_{i=1}^nG_H(x_i-x)w(x_i)(x_i-x)}{\sum_{i=1}^nG_H(x_i-x)w(x_i)}
$$
其中
$$
G_H(x_i-x)=|H|^{-\frac{1}{2}}G(H^{-\frac{1}{2}}(x_i-x))
$$
$h$ 是一个正定的对称矩阵，形式为
$$
H=\mathrm{diag}(h_1^2,h_2^2,\cdots,h_d^2)
$$

---
tags:
  - 编译原理
---

# 一个简单的语法制导翻译器

本章通过一个简单的例子来描述词法分词、语法分词、语义分析、翻译制导等部分的内容。该章节的目的是开发一个可以运行的程序来演示上面的编译技术。这个程序可以将具有代表性的程序设计语言翻译为三地址代码。

## 语法定义

### 文法定义

一个上下文无关文法由下面的四个元素组成：
1. 一个终结符号集合。也称为词法单元，是一个不可以细分的符号。
2. 一个非终结符号集合。也称语法变量，是递归定义的值，代表一个终结符号串的集合。
3. 一个产生式集合。
4. 一个非终结符号作为开始符号。

### 推导

根据文法推导符号串时，我们首先从开始符号出发，不断将某个非终结符号串替换为产生式的体。可以从开始符号推导得到的所有终结符号串的集合称为该文法定义的语言。

语法分析的任务是接受一个终结符号串作为输入，找出从文法的开始符号推导这个串的方法。如果不能推导，则报告该终结符号中的语法错误。

### 语法分析树

语法分析树用图形的方式展现了从文法的开始符号推导出相应语言中的符号串的过程。正式的说，给定一个上下文无关文法，该文法的一棵语法分析树具有以下性质：
1. 根节点的符号为该文法的开始符号
2. 每个叶子节点的标号为一个终结符号或者 $\epsilon$
3. 每个内部节点的标号为一个非终结符号

一个文法的语言的另一个定义是指任何由某棵语法分析树生成的符号串的集合。为一个给定的终结符号串构建一棵语法分析树的过程称为对该符号串进行语法分析。

### 二义性

根据一个文法讨论某个符号串的结构时，存在一种情况，即一个文法可能存在多棵语法分析树能够生成同一个给定的终结符号串，这样的文法具有二义性。

### 运算符的结合性

当一个运算分量的两侧都有运算符时，我们需要一些规则来决定哪个预算符被应用与该运算分量。
- 当一个运算分量的左右两边都有+时，它属于左边的运算符，因此它是*左结合的*。
- 一些运算符时右结合的，例如指数运算，或者=。

### 运算符的优先性

结合性规则只能作用于同一个运算符的多次出现，因此它无法解决多种运算符的二义性。当多种运算符出现时，我们需要一些规则来定义运算符之间的相对优先关系。

## 语法制导翻译

语法制导翻译是通过向一个文法的产生式附加一些规则或者程序片段得到的。本节介绍两个与语法制导翻译相关的概念：
1. 属性 (attribute)：属性表示与某个程序构造相关的任意的量。属性可以是多种多样的，例如表达式的数据类型。
2. (语法制导的) 翻译方案：翻译方案是一种将程序片段附加到一个文法的各个产生式上的表示法。当在语法分析过程中使用一个产生式时，相应的程序片段就会执行。这些程序片段的执行效果按照语法分析过程顺序组合起来，就得到这次翻译的结果。

### 综合属性

将量和程序构造关联起来的想法可以基于文法来表示。我们将属性和文法的非终结符号及终结符号相关联，然后，我们给文法的各个产生式附加上语义规则。对于语法分析树中的一个节点，如果它和它的子节点之间的关系符合某个产生式，那么该产生式对应的规则就描述了如何计算这个节点的属性。

### 简单语法制导定义

要得到代表产生式头部的非终结符号的翻译结果字符串，只需要将产生式中各非终结符号的翻译结果按照它们在非终结符号中的出现顺序连接起来，并在其中穿插一些附件的串即可。具有这个性质的语法制导定义为简单语法制导定义。

### 树的遍历

树的遍历将用于描述属性的求值过程，以及描述一个翻译方案中的各个代码片段的执行过程。一个树的遍历从根节点开始，按照某个顺序访问树的各个节点。

一次深度优先遍历从根节点开始，递归按照任意顺序访问各个节点的子节点。语法制导定义没有规定一棵语法分析树中各个属性的求值顺序，只要一个顺序能够保证计算 a 时，a 所依赖的属性都已经计算完毕，这个顺序就是可以接受的。综合属性可以在自底向上遍历的时候计算。

### 翻译方案

语法制导翻译方案是一种在文法产生式中附加一些程序片段来描述翻译结果的表示方式。语法制导翻译方案和语法制导定义相似，知识显示指定了语义规则的计算顺序。

被嵌入到产生式体中的程序片段被称为语义动作，一个语义动作用花括号括起来，并写入到产生式的体中，它的执行位置也由此指定，按如下规则所示：
$$
rest \to +\ term\ \{\text{print('+')}\}\ rest_1
$$
当我们考虑表达式的另一种形式的文法时，我们就会看到这样的规则，其中非终结符号 $rest$ 代表一个表达式中除了第一个项以外的一切。

实现一个翻译方案时，必须保证各个语义动作按照它们在语法分析树的后序遍历中的顺序执行。这个实现并不一定要构造出语法分析树，只要保证语义动作的执行过程正确就行。

## 语法分析

语法分析是决定如何使用一个文法生成一个终结符号串的过程。在讨论这问题时，我们可以想象我们正在构建一个语法分析树，这样可以帮助我们理解分析的过程，但是在实际上在实践中我们没有直接构造。

本节介绍一种称为递归下降的语法分析方法，该方法可以用于语法分析和实现语法制导翻译器。

大多数语法分析法方法都可以归入下面两类：自顶向下方法和自底向上方法，这两个属于是指语法分析树节点的构造顺序。

### 自顶向下分析方法

自顶向下方法从标号为开始节点的非终结符号 stmt 开始，从根节点反复执行下面的两个步骤：
1. 在标号为非终结符号 A 的节点 N 上，选择 A 的一个产生式，并为该产生式体中的各个符号构造出 N 的子节点。
2. 寻找下一个节点来构造子树，通常选择语法分析树最左边的尚未扩展的非终结符

对于某些文法，上面的步骤只需要对输入从左到右扫描一次就可以了。输入中当前被扫描到的终结符号通常称为向前看 (lookhead) 符号。在开始时，向前看符号是输入串中的第一个终结符号。
- 如果向前看符号指向一个非终结符号，则从产生式中选择相应的产生式，并将树节点拓展
- 如果向前看符号指向一个终结符号，且与向前看符号匹配，那么语法分析树的箭头和输入箭头都前进一步。

### 预测分析法

递归下降分析方法是一种自顶向下的语法分析方法，它使用一组递归过程来处理输入。文法的每个非终结符都有一个相关联的过程，这里我们考虑递归下降分析法的一种简单的形式，称为预测分析法。在预测分析法中，各个非终结符号对应的过程中的控制流可以由向前看符号无二义性地确定。在分析输入串时出现的过程调用序列隐式的定义了该输入串的一棵语法分析树。


---
tags:
  - 编译原理
  - 概述
---

# 编译器简介

## 编译器定义

将某一种程序设计语言写的程序翻译成等价的另一种语言的程序，称之为**编译程序**。在编译器中，一般遵循下面的基本定义：
- 源语言 (source language)：编译器输入程序的描述语言，一般指高级程序设计语言。
- 源程序 (source program)：编译程序的输入程序。
- 目标语言 (target language)：目标程序的描述语言。
- 目标程序 (target program)：源程序经过编译后生成的程序。

编译器也是使用变成语言实现的一种程序，因此我们称编译程序的实现语言为**宿主语言**，编译程序的运行环境为**宿主机** (目标机)。

编译器通过将源程序等价变换，得到目标程序。
```mermaid
graph LR
A["源程序"]-->|Compiler|B["目标程序"]
```

目前常见的变成语言包括：
- C 是编译型语言
- Lisp 是解释型语言
- Java 先被编译为字节码，然后解释执行

其中：
- **编译执行**是由编译程序生成一个与源程序等价的目标程序，它可以完全取代源程序，该目标程序可以运行任意次。
- **解释执行**不生成目标程序，仅是对源程序逐句解释逐句执行。

## 编译器表示

1. 编译器可以通过函数表述，其表述为：
$$
T=C(S)
$$
其中 $T$ 表示目标程序，$C$ 表示编译程序，$S$ 表示源程序。
2. 或者使用 T 型图表示，其表示为

![[Assets/Pasted image 20240229194207.png]]
使用 T 型图可以直观的表示多种编译程序联立的情景，假设现在将 A 机器上已经存在的 L 语言的编译程序移植到 B 机器上，那么可以使用 T 型图表示为

![[Assets/Pasted image 20240229194619.png]]

3. 使用符号表示，表示为
$$
C^{源\, 目}_{宿}
$$

## 编译器的组织与结构

一般编译程序的逻辑结构如下图所示：
![[Assets/Pasted image 20240229195734.png]]

### 词法分析

词法分析 (lexical analysis) 阶段的任务是对输入的符号串的形式的源程序进行最初的加工处理。它依次扫描读入源程序中的每个字符，识别出源程序中有独立意义的源语言单词，用某种特定的数据结构对它的属性予以表示和标注。

简单来说，文本形式的程序通过词法分析，被加工为了属性字符流，将文本中的每个独立的字符、标识符分割开来，便于处理。
![[Assets/Pasted image 20240229200114.png]]

### 语法分析

语法分析 (Syntax analysis) 依据语言文本所规定的语法规则，对词法分析的结果进行语法检查，并识别出单词序列所对应的语法范畴。通常将语法分析的过程结果表示为分析树 (parse tree) 或者语法树 (syntax tree)。它是一种层次结构形式。

![[Assets/Pasted image 20240229200310.png]]

### 语义分析与中间代码生成

语义分析阶段依据语言文本限定的语义规则对语法分析所识别的语法范畴进行语义检查和处理，直到最后翻译成与其等价的某种中间代码或者目标代码。**语义分析是整个编译程序完成的最实质性的翻译任务**。

通过语义分析后生成后的中间代码通常表示为四元组的形式，类似与汇编语言中的操作符、操作地址的形式。

### 代码优化

代码优化式为了改进目标代码的质量而在编译过程中进行的工作。代码优化可以在中间代码或者目标代码级上进行，其实质是在不改变源程序予以的基础上对其进行加工变换，以期待获得更高效的目标代码。而高效一般是对所产生的目标程序在运行时间的缩短与贮存空间的节省而言。

### 目标代码的生成

根据中间代码及编译过程中产生的各种表格的有关信息，最终生成所期望的目标代码程序。一般为特定机器的机器语言代码或者汇编代码。

整个编译阶段与自然语言类比，可以描述为：

|  编译程序  |  自然语言翻译  |
| :----: | :------: |
|  词法分析  | 查字典、识别单词 |
|  语法分析  | 分析识别的句子  |
| 产生中间代码 |   翻译初稿   |
|  代码优化  | 对初稿润色修饰  |
| 目标代码生成 |   译文定稿   |
### 表格管理与出错处理

在编译器的处理逻辑中，还有两个辅助的步骤，分别是表格管理和出错处理。
- 表格管理：编译程序的公共辅助程序，对源程序中的各种量进行管理，登记相应的表格。编译程序处理时通过查表得到所需的信息。
- 出错处理：编译程序的公共辅助程序，对源程序中的各种错误检查、定位、定性、报告，并尽可能将错误限制在尽可能小的范围内，保障编译继续。

## 典型的编译器结构

对源程序或者源程序的中间形式进行处理时，需要从头到尾扫描一遍，并做有关的分析加工，生成新的源程序的中间形式或者目标程序。这在编译原理中称为**遍**。遍的设置通常需要考虑：
1. 宿主机存储容量
2. 编译程序功能的强弱
3. 源语言的繁简及约束
4. 优化因素
5. 设计、实现的环境、工具及人员因素等

典型的编译器结构包括：
- 一遍扫描的编译程序结构模型。
- AHPL 模拟器 (两边扫描)
- PDP-11C 编译器结构模型
- Tiger compiler structure
- GCC complier structure
- LLVM 编译器结构
- 等等

## 编译流程

到目前为止，只是简单的罗列了关于编译器的概念。如果一个编译器拆开，那么就可以看到这个映射过程的两个部分：
- 分析 (analysis) 部分吧源程序分解为多个组成要素，并在这些要素之上加上语法树。然后，它使用这个结构来创建该源程序的一个中间表示。分析部分还会收集有关源程序的信息，并把信息存放在一个称为符号表的数据结构中。
- 综合 (synthesis) 部分根据中间表示和符号表中的信息来构造用于期待中的目标程序。

分析部分经常被称为编译器的前端 (front end)，而综合部分称为后端 (back end)。

代码在编译器中经过了下面的变化：

![[Assets/Pasted image 20240406200237.png]]
有些编译器在前端和后端之前还有一个与机器无关的优化步骤。这个步骤主要是在中间表示之上进行转换，以便后端程序可以生成更好的目标程序。

### 词法分析

编译器的第一个步骤称为*词法分析* (lexical analysis) 或者*扫描* (scanning)。词法分析器读入组成源程序的字符流，并将它们组织成有意义的词素 (lexeme) 的序列。对于每个词素，词法分析器产生如下形式的词法单元 (token) 作为输出：
$$
\braket{\text{token-name, attribute-value}}
$$
这个词法单元被传送给下一个步骤，即语法分析。

### 语法分析

编译器的第二个步骤称为*语法分析* (syntax analysis) 或者*解析* (parsing)。**语法分析器使用由词法分析器生成的各个词法单元的第一个分量来创建树形的中间表示**。该中间表示给出了词法分析产生的词法单元流的语法结构。一个常用的方法是语法树 (syntax tree)，树种的每个内部节点表示一个运算，而该节点的子节点表示该运算的分量。

编译器的后续步骤将使用这个语法结构来帮助分析源程序，并生成目标程序。

### 语义分析

语义分析器 (semantic analyzer) 使用语法树和符号表中的信息来检查源程序是否和语言定义的语义一致。它同时也收集类型信息，并把这些信息存放在语法树或者符号表中，以便在随后的中间代码生成过程中使用。

语义分析的一个重要部分是类型检查 (type checking)。编译器检查每个运算符是否具有匹配的运算分量。

### 中间代码生成

把一个源程序翻译成目标代码的过程中，一个编译器可能构造出一个或者多个中间表示。这些中间表示可以有多种形式。语法树是一种中间表示形式，它们通常在语法分析和语义分析中使用。

在源程序的语法分析和语义分析完成之后，很多编译器生成一个明确的低级的或类机器语言的中间表示，我们可以把这个看作是某个抽象机器的程序。该中间表示有两个重要性质：
1. 易于生成。
2. 能够被轻松的翻译为目标机器上的语言。

### 代码优化

机器无关的代码优化步骤试图改进中间代码，以便生成更好的目标代码。更好通常意味着更快，但是也可能有其他目标。

### 代码生成

代码生成器以源程序的中间表示形式作为输入，并把它映射到目标语言。如果目标语言是机器代码，那么就必须为程序使用的每个变量选择寄存器或内存位置，代码生成的一个至关重要的方面是合理分配寄存器以存放变量的值。

### 符号表管理

编译器的重要功能之一是记录源程序中使用的变量的名字，并收集和每个名字的各种属性有关的信息。这些属性可以提供一个名字的存储分配、它的类型、作用域等信息。

符号表数据结构为每个变量创建了一个记录条目，记录的字段就是名字的各个属性。这个数据结构允许编译器迅速查找每个名字的记录，并向记录中快速存放和获取记录的数据。

### 将多个步骤组合

前面讨论的是编译器的逻辑组织方式，在一个特定的实现中，多个步骤的活动可以被组合为一趟 (pass)，每趟读入一个输入文件并产生一个输出文件。

### 编译器构造工具

写编译器的人可以利用现代的软件开发环境。这些环境包含了诸如语言编辑器、调试器、版本管理、程序描述器等工具。除了这些通用的软件开发工具，人们还创建了更加专业的工具来实现编译器的不同阶段。这些工具使用专门的语言来描述，其中包含了相当复杂的算法。一些常用的编译器构造工具包括：
1. 语法分析器的生成器：可以根据一个程序设计语言的语法描述自动生成语法分析器
2. 扫描器的生成器：可以根据一个语言的语法的单元的正则表达式描述生成词法分析器
3. 语法制导的翻译引擎：可以生成一组用于遍历分析树并生成中间代码的例程
4. 代码生成器的生成器：依据一组关于如何把中间语言的每个预算翻译成目标机上的语言的规则，生成一个代码生成器
5. 数据流分析引擎：可以帮助收集数据流信息，即程序中的值是如何从程序的一个部分传递到另一个部分。数据流分析是代码优化的一个重要部分。
6. 编译器构造工具集：提供了可用于构造编译器的不同阶段的例程的完整集合。
---
tags:
  - 计算机网络
---

# 计算机网络体系结构

一般认为，计算机网络是一个将众多分散的、自治的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。

计算机网络由若干节点(node)和连接这些节点的链路(link)组成。网络中的节点可以是计算机、集线器、交换机或路由器等。网络之间还可以通过路由器互连，构成一个覆盖范围更广的计算机网络，这样的网络称为**互联网**(internet)。

于是，我们可以这样理解：网络把许多计算机连在一起，而互联网则把许多网络通过路由器连在一起。

> [!note] 
> - **internet**(互联网)：通用名词，泛指由多个计算机网络互连而成的计算机网络。在这些网络之间可以使用任意的通信协议作为通信规则。
> - **Internet**(因特网或互联网)：专用名词，指当前全球最大的、开放的、由众多网络和路由器互连而成的特定计算机网络，它采用 TCP/IP 协议作为通信规则。

## 计算机网络的组成

从不同的角度看，可以将计算机网络的组成分为以下几类：
1. 从组成部分看，计算机网络主要由硬件、软件、协议三大部分组成。
	- **硬件**：由主机(端系统)、通信链路(如双绞线、光纤)、交换设备(如路由器、交换机等)和通信处理机(网卡)等组成。
	- **软件**：包含各种实现资源共享的软件和方便用户使用的各种工具软件^[如 E-mail 程序、FTP 程序、聊天程序等]。
	- **协议**：计算机网络的核心，如同交通规则制约汽车驾驶一样，协议规定了网络传输数据时所遵守的规范。
2. 从工作方式来看，计算机网络可以分为边缘部分和核心部分。
	- **边缘部分**：由所有连接到互联网上的供用户直接使用的主机组成，用来进行通信和资源共享。
	- **核心部分**：由大量网络和连接这些网络的路由器组成，它为边缘部分提供连通性和交换服务。
3. 从功能部件来看，计算机网络由通信子网和资源子网组成。
	- **通信子网**：由各种传输介质、通信设备和相应的网络协议组成，它使网络具有数据传输、交换、控制和存储的能力，实现联网计算机之间的数据通信。
	- **资源子网**：实现资源共享功能的设备及其软件的集合，由网络用户提供共享其他计算机上的硬件资源、软件资源和数据资源的服务。

## 计算机网络的功能

计算机网络主要有以下 5 大功能：
1. **数据通信**：计算机网络最基本和最重要的功能，用来实现联网计算机之间各种信息的传输，并联系分散在不同地理位置的计算机，进行同一的调配、控制和管理。
2. **资源共享**：资源共享即可是软件共享、数据共享，也可以是硬件共享。它使计算机网络中的资源互通有无，分工协作，从而极大的提供了硬件资源、软件资源和数据资源的利用率。
3. **分布式处理**：当计算机网络中的某个计算机负荷过重时，可以将其处理的某个复杂任务分配给网络中的其他计算机系统，从而利用空闲计算机资源来提高整个系统的利用率。
4. **提高可靠性**：计算机网络中的各台计算机可以通过网络互为替代机。
5. **负载均衡**：将工作任务均匀地分配给计算机网络中的各台计算机。

## 交换

在网络核心部分起重要作用的是**路由器**(router)，它对收到的分组进行存储转发来实现分组交换。从通信资源分配的角度看，交换就是按找某个方式动态地分配传输线路的资源。

### 电路交换

最典型的电路交换网是传统电话网，电路交换分为三步：连接建立、数据传输和连接释放。在进行数据传输前，两个节点之间必须先建立一条专用(双方独占)的物理通信路径，该路径可能经过许多中间节点。在数据传输过程中，这一物理通信路径始终被用户独占，直到通信结束后才被释放。

在电路交换的整个通信阶段，比特流连续地从源点直达终点，就好像在一个管道传送。

> [!note] 电路交换技术的特点
> - 优点：
> 	- **通信时延小**。通信线路双方专用，数据直达，所以传输时延非常小。
> 	- **有序传输**。双方通信时按发送顺序传送数据，不存在失序问题。
> 	- **没有冲突**。不同的通信双方拥有不同的信道，不会出现争用物理信道的问题。
> 	- **适用范围广**。电路交换既适用于传送模拟信号，又适用与传送数字信号。
> 	- **实时性强**。通信双方之间的物理通路一旦建立，双方就可以随时通信。
> 	- **控制简单**。电路交换的交换设备及其控制简单。
> - 缺点：
> 	- **建立连接时间长**。电路交换的平均连接时间对计算机通信来说太长了。
> 	- **线路利用率低**。物理通路被通信双方独占，即使线路空闲，也不能供其他用户使用。
> 	- **灵活性差**。物理通路中的任何一点出现故障，就必须重新拨号建立新的连接。
> 	- **难以规格化**。不同类型、不同规格、不同速率的终端很难相互通信。
> 	- **难以实现差错控制**。中间节点不具备存储和检验数据的能力，无法发现并纠正错误。

### 报文交换

数据交换的单位是报文。用户数据加上原地址、目的地址等信息后，封装为**报文**(message)。报文交换采用的是**存储转发技术**，整个报文线传送到相邻节点，全部存储后查找转发表，转发到下一个节点，如此重复，直到达到目的节点。每个报文都可以单独选择到达目的节点的路径。

> [!note] 报文交换的特点
> - 优点：
> 	- **无需建立连接通路**。通信前无须建立连接，没有建立连接时延，用户可以随时发送报文。
> 	- **动态分配路线**。交换设备存储整个报文后，选择一条合适的空闲线路，转发报文。
> 	- **线路可靠性高**。若某条传输路径发生故障，则可以重新选择另一条路径传输数据。
> 	- **线路利用率高**。报文在哪段链路上传送时才占用这段链路的通信资源。
> 	- **提供多目标服务**。一个报文可以同时发送给多个目的地址。
> - 缺点：
> 	- **转发时延高**。交换节点要将整个报文整体接收完后，才能查找转发表转发到下一个节点。
> 	- **缓存开销大**。报文的大小没有限制，这就要求交换节点拥有较大的缓冲空间。
> 	- **错误处理低效**。报文较长时，发生错误的概率相对较大，重传整个报文的代价也很大。

### 分组交换

分组交换也采用**存储转发技术**，但是解决了报文交换中的报文过长的问题。若报文太长，则对交换节点的缓存容量就有了很大的需求，在错误处理方面也比较低效。在分组交换中，源节点在发送前，先把较长的报文划分为若干较小的等长数据段，在每个数据段前面添加一些必要的控制信息^[如源地址、目的地址、编号信息等]组成的首部，构成**分组**(Packet)。

源节点将分组发送到分组交换网中，分组交换网中的分组交换机收到一个分组后，先将其缓存，然后从其首部中提取目的地址，据此查找自己的转发表，再后将分组转发给下一个分组交换机。经过多个分组交换机的存储转发后，分组最终到达目的节点。

> [!note] 分组交换的特点
> - 优点：
> 	- **无建立时延**。通信前无需建立连接，没有建立连接时延，用户可以随意发送分组。
> 	- **线路利用率高**。分组在哪条链路上传送时才占用这段链路的通信资源。相比采用电路交换数据突发式的计算机数据，分组交换的通信线路利用率大大提高。
> 	- **简化了存储管理**。相对于报文交换，分组的长度固定，相应的缓冲区大小也固定，在交换节点中存储器的管理通常被简化为对缓冲区的管理，相对较容易。
> 	- **加速传输**。分组是逐个传输的，可以使后一个分组的存储操作与前一个分组的转发操作并行，即[[计算机组成原理/中央处理器#指令流水线|流水线方式]]传输每个分组。此外，传输一个分组比传输一次报文所需的缓冲区小得多，这样，因缓冲区不足而等待发送的概率及时间也小得多。
> 	- **减小了出错的概率和重发数据量**。因为分组较短，其错误概率小，出错时重发数据量也少。这样不仅提高了可靠性，而且减少了传输时延。
> - 缺点：
> 	- **存在存储转发时延**。尽管分组交换比报文交换的传输时延小，但是相对与电路交换任存在存储转发时延，且其节点交换机必须具有更强的处理能力。
> 	- **需要传输额外的信息量**。每个小数据段都要加上控制信息以构成分组，这使得传送的信息量增大了 5%~10%，进而使得控制复杂，降低了通信效率，增大了处理的时延。
> 	- **可能出现失序、丢失或重复分组**的情况，分组到达节点时，要对分组按编号进行排序等工作，而这些工作比较麻烦。若采用虚电路服务，虽然没有失序问题，但是有呼叫建立，数据传输和虚电路释放三个过程。

当传输的数据量很大且其传送时间远大于呼叫时间时，采用电路交换较为合适。当端到端的通路由多段链路组成时，采用分组交换传送数据较为合适。

> [!example]- 三种方式对比
> ![[image/计算机网络系统结构-1.png|center]]

## 计算机网络的分类

1. 按分布范围分类：
	1. **广域网**(WAN)：广域网的任务是提供长距离通信，运送主机所发送的数据，其覆盖分为通常是直径为几千千米的区域。广域网是互联网的核心部分，连接广域网的各个节点交换机的链路一般是高速链路，具有较大的通信容量。
	2. **城域网**(MAN)：城域网的覆盖范围可以跨越几个街区甚至城市，覆盖直径为 5~50km。城域网一般采用以太网技术，因此有时也并入局域网的范围讨论。
	3. **局域网**(LAN)：局域网一般用主机通过高速线路相连接，覆盖范围较小，通常是直接为几千米的区域，传统上，局域网使用广播技术，而广域网使用交换技术。
	4. **个人区域网**(PAN)。个人区域网是指个人工作的地方将消费电子设备用无线技术连接起来的网络，也称无线个人区域网(WPAN)。
2. 按传输技术分类：
	1. **广播式网络**。所有联网计算机都共享一个公共通信信道，当一台计算机利用共享通信信道发送报文分组时，所有其他计算机都会收听到这个分组。接收到该分组的计算机将通过检查目的地址来决定是否接收该分组。*局域网基本都采用广播式通信技术，广域网中的无线、卫星通信网络也采用广播式通信技术*。
	2. **点对点网络**。每条物理线路连接一对计算机。若通信的两台主机之间没有直接连接的线路，则它们之间的分组传送就要通过中间节点进行存储和转发，直至目的节点。
3. 按拓扑结构分类：
	1. **总线行网络**。用单根传输线把计算机连接起来。
		- 优点：建网容易，增减节点方便、节省线路。
		- 缺点：重负载时通信效率不高，总线任意一处对故障敏感。
	2. **星形网络**。每个终端或计算机都以单独的线路与中央设备相连。中央设备一般是交换机或路由器。
		- 优点：便于集中控制和管理。
		- 缺点：成本高，中央设备对故障敏感。
	3. **环形网络**。所有计算机接口设备连接成一个环。
	4. **网状网络**。一般情况下，每个节点至少有两条路径与其他节点相连，多用于广域网中。
4. 按使用者分类：
	1. **公用网**(Public Network)。指电信公司出资建造的大型网络。公用的意思是所有愿意按照电信公司的规定缴纳费用的人都可以使用这种网络。
	2. **专用网**(Private Network)。指某个部门为满足本单位特殊业务的需要而建造的网络。这种网络不向本单位外的人提供服务，如铁路、电路、军队等部门的专用网络。
5. 按传输介质分类：可以分为有线、无线。有线网络又可以分为双绞线网络、同轴电缆网络等，无线网络又可以分为蓝牙、微波、无线电等类型。

## 计算机网络的性能指标

性能指标从不同方面度量计算机网络的性能。通常的性能指标如下：
1. **速率**(Speed)：指连接到网络上的节点在数字信道上传输数据的速率，也称为**数据传输速率、数据传输率、数据率或比特率**，单位是 b/s^[比特/秒，也写为 bit/s、bps。此外，还有 kb/s、Mb/s、Gb/s 等。需要注意，这些单位是以 10 为底的，即 $k=10^{3},M=10^{6},G=10^{9}$]。
2. **带宽**(Bandwidth)：带宽原本表示通信线路允许通过的信号频率范围，单位是赫兹。在计算机网络中，带宽表示网络的通信线路所能传送数据的能力，是数字信道所能传送的**最高数据传输速率**的同义词，单位为 b/s。
3. **吞吐量**(Throughput)：指单位时间内通过某个网络的实际数据量。吞吐量常用于对实际网络的测量中，首网络带宽的限制。
4. **时延**(Delay)：指数据(一个报文或分组)从网络的一端传输到另一端所需的总时间，它由发送时延、传播时延、处理时延和排队时延四个部分组成。
	- **发送时延**：也称传输时延，节点将分组的所有比特推向链路所用的时间，即从发送分组的第一个比特算起，到该分组的最后一个比特发送完毕所需的时间。*发送时延=分组长度/发送速率*。
	- **传播时延**：电磁波在信道中传播一定距离所花的时间，即一个比特从链路的一端传播到另一端所需的时间。*传播时延=信道长度/电磁波在信道上的传播速率*。
	- **处理时延**。数据在交换节点为存储转发而进行一些必要操作所花的时间。例如，分析分组的首部、从分组中提取数据、差错检查或查找合适的路由器等。
	- **排队时延**。分组在进入路由器后要先在输入队列中排队等待处理。路由器确定转发端口后，还要在输出队列中排队等待转发。
5. **时延带宽积**：指发送端发送的第一个比特即将到达终点时，发送端已经发送了多少比特，又称为以比特为单位的链路长度，即*时延带宽积=传播时延×信道带宽*。
6. **往返时延**(Round-Trip Time, RTT)：指从发送端发出一个短分组，到发送端收到来自接收端的确认总共经历的时延。在互联网中，往返时延还包括中间节点的处理时延、排队时延及转发数据时的发送时延。
7. **信道利用率**：用于指出某个信道有百分之多少的时间是由数据通过的。*信道利用率=有数据通过的时间/总时间*。

> [!tip] 
> 1. 区分传输时延与传播时延，前者是路由器将分组推出所用的时间，是分组长度与链路传输速率的函数；后者是一个比特从一台路由器传播至另一台路由器所需的数据，是两条路由器之间的距离的函数，而与分组长度或链路传输速率无关。
> 2. 处理时延和排队时延通常可以忽略不计。

## 计算机网络分层结构

计算机网络的各层及其协议的集合称为网络的**体系结构**(Architecture)。换言之，计算机网络的体系结构就是这个计算机网络及其应完成的功能的精确定义。要强调的是，这些功能究竟是用何种硬件或软件完成的，是一个遵循这种体系结构的实现(implementation)问题。体系结构是抽象的，而实现是具体的，是真正在运行的计算机硬件和软件。计算机网络体系结构通常都具有可分层的特性，它将复杂的大系统分为若干较容易实现的层次。

> [!note] 分层的基本原则
> 1. 每层都实现一种相对独立的功能，降低大系统的复杂度。
> 2. 各层之间的接口自然清晰，易于理解，相互交流尽可能少。
> 3. 各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术来实现。
> 4. 保持下层对上层的独立性，上层单向使用下层提供的服务。
> 5. 整个分层结构应能够促进标准化工作。

在计算机网络分层结构中，第 $n$ 层中的活动元素通常称为第 $n$ 层实体。具体来说
- **实体**指任何可发送或接收信息的硬件或软件进程，通常是某个特定的软件模块。
- 不同机器上的同一层称为**对等层**，同一层的实体称为**对等实体**。
- 第 $n$ 层实体实现的服务为第 $n+1$ 层所用。在这种情况下，第 $n$ 层称为**服务提供者**，第 $n+1$ 层则服务于用户。

在计算机网络体系结构中，对等层之间传送的数据单位称为该层的**协议数据单元**(PDU)，第 $n$ 层的 PDU 记为 n-PDU。各层的 PDU 都分为数据和控制信息两部分：
- **服务数据单元**(SDU)：为完成用于所要求的功能而传递的数据。第 $n$ 层的 SDU 记为 n-SDU。
- **协议控制信息**(PCI)：控制协议操作的信息。第 $n$ 层的 PCI 记为 n-PCI。

> [!note] 
> 每层的协议数据单元都有一个通俗的名称，例如物理层的 PDU 称为**比特流**，数据链路层的 PDU 称为**帧**，网络层的 PDU 称为**分组**，传输层的 PDU 称为**报文段**。

当在各层之间传输数据时，将从第 $n+1$ 层收到的 PDU 作为第 $n$ 层的 SDU，加上第 $n$ 层的 PCI，就封装成了第 $n$ 层的 PDU，交给第 $n-1$ 层后作为 SDU 发送，接收方进行相反的处理。因此，PDU、SDU、PCI 三者的关系为：
$$
\text{n-SDU}+\text{n-PCI}=\text{n-PDU}=\text{(n-1)-SDU}
$$ 
> [!note] 层次结构的含义
> 1. 第 $n$ 层的实体不仅要使用第 $n-1$ 层的服务来实现自身定义的功能，而且要向第 $n-1$ 层提供本层的服务，该服务是第 $n$ 层及其下面各层提供的服务的总和。
> 2. 最低层只提供服务，是整个层次结构的基础。最高层面向用户提供服务。
> 3. 上一层只能通过相邻层间的接口使用下一层的服务，而不能调用其他层的服务。
> 4. 当两台主机通信时，对等层在逻辑上有一个直接信道，表现为能直接将信息传送到对方。

## 计算机网络协议、接口、服务

### 协议

要在网络中做到有条不紊地交换数据，就必须遵循一些实现约定好的规则，其规定了所交换的数据格式及其有关的同步问题。**为了在网络中进行数据交换而建立的这些规则、标准或约定称为网络协议**(Network Protocol)，是控制在对等实体之间进行通信的规则的集合，是水平的。

> [!note] 
> 不对等的实体之间是没有协议的，如用 TCP/IP 协议栈通信的两个节点 A 和 B，节点 A 的传输层和节点 B 的传输层之间存在协议，但是节点 A 的传输层和节点 B 的网络层之间不存在协议。

协议由语法、语义和同步三部分组成。
1. **语法**：数据与控制信息的格式。*例如，TCP 报文段格式就是由 TCP 协议的语法定义的*。
2. **语义**：即需要发出何种控制信息、完成何种动作及做出何种应答。*例如，在建立 TCP 链接的三次握手时所执行的操作就是由 TCP 协议的语义定义的*。
3. **同步**(或时序)：执行各种操作的条件、时序关系等，即时间实现顺序的详细说明。*例如，建立 TCP 连接的三次握手操作的实现关系就是由 TCP 协议的同步定义的*。

### 接口

同一节点内相邻两层的实体交换信息的逻辑接口称为**服务访问点**(Service Access Point, SAP)。每层只能为紧邻的层之间定义接口，而不能跨层定义接口。服务是通过 SAP 提供给上层使用的，第 $n$ 层的 SAP 就是第 $n+1$ 层可以访问第 $n$ 层服务的地方。

### 服务

服务是指下层为紧邻的上层提供的功能调用，是垂直的。对等实体在协议的控制下，使得本层能为上层提供服务，但要实现本层协议，还需要使用下层提供的服务。当上层使用下层提供的服务时，必须与下层交换一些命令，这些命令称为**服务原语**。

OSI 参考模型将原语划分为四类：
1. **请求**(Request)：由服务用户发往服务提供者，请求完成某项工作。
2. **指示**(Indication)：由服务提供者发往服务用户，请示用户做某件时间。
3. **响应**(Response)：由服务用户发往服务提供者，作为对指示的响应。
4. **证实**(Confirmation)：由服务提供者发往服务用户，作为对请求的证实。

> [!example] 四类原语的关系
> ![[image/计算机网络系统结构-2.png]]

计算机网络提供的服务可以按照以下三种方式分类：
1. 面向连接服务与无连接服务
	- 在**面向连接服务**中，通信前双方必须先建立连接，分配相应的资源以保证通信能够正常进行，传输结束后释放连接和占用的资源。因此这种服务可以分为连接建立、数据传输和连接释放三个阶段。*例如，TCP 就是一种面向连接服务的协议*。
	- 在**无连接服务**中，通信前双方不需要先建立连接，需要发送数据时可以直接发送，将每个带有目的地址的包传送到线路上，有系统选定路线进行传输。这种服务常被描述为*尽最大努力交付*，是一种不可靠的服务。*例如，IP、UDP 就是一种无连接服务协议*。
2. 可靠服务与不可靠服务
	- **可靠服务**指网络具有纠错、检错、应答机制，能确保数据正确、可靠地传送到目的地。
	- **不可靠服务**指网络只是尽量让数据正确、可靠地传送到目的地，是一种尽力而为的服务。
3. 有应答服务与无应答服务
	- **有应答服务**是指接收方在收到数据后向发送方给出相应的应答，该应答由传输系统内部自动实现，而不由用户实现。发送的应答既可以是肯定回答，也可以是否定回答，通常在接收到的数据有错误时发送否定应答。*例如，文件传输服务是一种有应答服务*。
	- **无应答服务**是指接收方收到数据后不自动给出应答。若需要应答，则由高层实现。*例如，对于 WWW 服务，客户端收到服务器发送的页面文件后不给出应答*。

> [!tip] 协议与服务
> 协议与服务概念上是不一样的。
> - 只有本层协议的实现才能保证向上一层提供服务。本层的服务用户只能看见服务而无法看见下面的协议，即下面的协议对上层的服务用户是透明的。
> - 协议是水平的，即协议是控制对等实体之间通信的规则；服务是垂直的，即服务是由下层通过接口向上层提供的。
> - 并非在一层内完成的全部功能都称为服务，只有那些可以被上层实体看得见的功能才称为服务。

> [!example] 服务、协议与接口的关系
> ![[image/计算机网络系统结构-3.png]]

## ISO/OSI 参考模型

国际化标准组织(ISO)提出的网络体系结构模型称为**开放系统互连参考模型**(OSI/RM)，通常简称 OSI 参考模型。OSI 参考模型有 7 层，自上而下依次为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。
- 低三层统称**通信子网**，是为联网而附加的通信设备，完成数据传输的功能。
- 高三层统称**资源子网**，相当于计算机系统，完成数据的处理等功能。
- 传输层承上启下。

#### 物理层

物理层(Physics Layer)的传输单位是**比特**，功能是在物理介质上为数据端设备透明地传输原始比特流。物理层主要定义数据终端设备(DTE)和数据通信设备(DCE)的物理与逻辑连接方法。*物理层的接口标准很多，例如 EIA-232C、EIA/TIA RS-449、CCITT 的 X.21 等*。

物理层主要研究以下内容：
1. 通信链路与通信节点的连接需要一些电路接口，物理层规定了这些接口的一些参数，如机械形状和尺寸、交换电路的数量和排列等，*例如笔记本电脑上的网线接口*。
2. 物理层规定了通信链路上所传输的信号的意义和电气特征。*例如，若规定信号 X 代表数字 0，则当节点传输 0 时就发出信息 X，而当节点接收到信号 X 时就知道收到的是 0*。

> [!tip] 
> 传输信息所用的一些物理介质(如双绞线、光缆、无线信道等)并不在物理层协议之内，而是在物理层协议下面。因此，有人将物理介质当作第 0 层。

#### 数据链路层

数据链路层(Data Link Layer)的传输单位是**帧**。
---
tags:
  - 计算机网络
---

# 数据链路层

数据链路层的主要任务是实现帧在一段链路上或一个网络中进行传输。数据链路层协议有多种，但是有三个基本问题是共同的，即**封装称帧、透明传输、差错检测**。

数据链路层使用的信道主要有两种：
1. **点对点信道**，使用一对一的通信方式。PPP 协议就是目前使用最广泛的点对点协议。
2. **广播信道**，这种信道上连接的主机很多，使用一对多的广播通信方式。采用共享广播信道的有线局域网普遍使用 CSMA/CD 协议，而无线局域网则使用 CSMA/CA 协议。

## 数据链路层的功能

数据链路层使用物理层提供的*比特传输*服务，为网络层提供服务，将网络层的 *IP 数据报*(分组)封装成帧，传输给下一个相邻节点。下面是一些基本概念。
- **链路**(链路)：指从一个节点到相邻节点的一段物理线路。当进行数据通信时，两台计算机之间的通信路径往往要经过多段这样的链路。也称为**物理链路**，即传输介质(0 层)与物理层(1 层)实现的相邻节点间的物理链路。
- **数据链路**(逻辑链路)：当在一条链路上传输数据时，除了需要链路本身，还需要一些必要的通信协议来控制这些数据的传输，把实现这些协议的硬件和软件加到链路上，就构成了数据链路。
- **帧**：数据链路层对等实体之间进行逻辑通信的协议数据单元。数据链路层把网络层下交的数据构成帧发送到链路上，并把接受到的帧中的数据取出并上交给网络层。

### 为网络层提供服务

数据链路层通常可以为网络层提供如下三种服务：
1. **无确认的无连接服务**：源主机发送帧时不需要先建立链路连接，目的主机收到帧时不需要发回确认。数据传输的可靠性由高层负责。适用于误码率较低的信道，如以太网。
2. **有确认的无连接服务**：源主机发送帧时不需要建立链路连接，但目的主机收到帧时必须发回确认。源主机在所规定的时间内未收到确定信号时，就重传丢失的帧，以提高传输的可靠性。该服务适用于误码率较高的信道，如无线信道。
3. **有确认的面向连接服务**：帧传输过程分为三个阶段：建立链路、传输帧、释放链路。目的主机对收到的每一个帧都要返回确认。该服务适用于可靠性要求较高的场合。

### 链路管理

数据链路层连接的建立、维持和释放过程称为**链路管理**，它主要用于面向连接的服务。链路两端的节点要进行通信，必须首先确认对方以处于就绪状态，并交换一些必要的信息以对帧序号初始化，然后才能建立连接。在传输过程中要能维持连接，而在传输完毕后要释放该连接。

### 封装成帧与透明传输

封装成帧是指在一段数据的前后分别添加首部和尾部，构成帧。
- **帧**是数据链路层的数据传送单元，**帧长**等于帧的数据部分长度加上首部和尾部的长度。
- 首部和尾部中含有很多的控制信息，它们的一个重要作用就是确定帧的界限，即**帧定界**。
- 接收方能从接受到的二进制比特流中区分出帧的起始与终止，即**帧同步**。

若在数据中恰好出现与帧定界符相同的比特组合^[会误认为传输结束而丢弃后面的数据]，则要采取有效的措施来解决这个问题，即**透明传输**。更切确地说，透明传输是指不论所传的数据是什么样的比特组合，都能按照原样无差错地在这个数据链路上传输。

### 流量控制

因为链路两端节点的工作速率和缓存空间存在差异，所以发送放的发送能力可能大于接收方的接收能力，若此时不限制发送方的发送速率，前面来不及接收的帧将被后面不断发来的帧覆盖，造成帧的丢失而出错。因此，**流量控制**实际上就是限制发送放的发送速率，使之不超过接收方的接收能力。这个过程需要某种反馈机制，使发送方知道什么情况下可以接着发送下一帧，而在什么情况下必须暂停发送。

> [!note] 
> 在 OSI 体系结构中，数据链路层具有流量控制的功能，而在 TCP/IP 体系结构中，流量控制功能被移动到了传输层。它们控制的对象不同。
> - 对于数据链路层来说，控制的是相邻节点之间的数据链路上的流量。
> - 对与传输层来说，控制的是从源端到目的端之间的流量。

### 差错检测

因为信道噪声的缘故，帧在传输过程中可能会出现错误，这些错误分为位错和帧错。
- **位错**：帧中某些位出现差错，通常采用**循环冗余检验**(CRC)来发现位错。
- **帧错**：帧丢失、帧重复、帧失序等错误。

过去的 ISO 观点认为，必须让数据链路层向上提供可靠传输，因此在 CRC 检错的基础上，增加了帧编号、确认和重传机制。收到正确的帧就要向对伐发送确认，发送方在一定期限内未收到对方的确认，就认为出了差错，因此进行重传，直到收到确认为止。
- 现在，在通信质量较差的无线传输中，数据链路层依然使用确认和重传机制，向上提供可靠的传输服务。
- 对于通信质量较好的有线链路，数据链路层不再使用确认和重传机制，仅需要进行 CRC 检错，目的是将有差错的帧丢弃，保证上交的帧都是正确的。而对于出错的帧的重传任务，由高层协议(如传输层的 TCP 协议)完成。

## 组帧

发送放依据一定的规则将网络层递交的分组**封装成帧**，也称为组帧。数据链路层之所以要将比特组合成以帧为单位传输，是为了在出错时指重发出错的帧，而不必重发全部的数据，从而提高效率。组帧主要解决帧定界、帧同步、透明传输等问题。


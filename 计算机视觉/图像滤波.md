---
aliases:
  - filter
tags:
  - 计算机视觉
---

# 图像滤波

## 图像数据

现实世界中，我们的所做的所有的事情都可以看做信号。在这里，信号是一个参数具有物理意义的函数，我们在现实世界中收集数据，就是对这个函数进行采样。而图像可以看做这个函数的一种采样方式。一般而言，图像数据有下面几种类型：

- 二维变量：xy坐标
- 三维变量：xy坐标与时间轴(视屏)
- 亮度

常见的图像数据有二值图像(binary)，灰度图(Gray)，彩色图(Color)。其中二值图像与灰度图像都是单通道的，而彩色图有rgb三通道的，也有rgba四通道形式的。

**图像是被采样并且离散化的**。一个图像的每个像素由离散的数字表示，常用表示方式有使用0到255的整数三元组表示图像像素的 RGB 模式，使用0到1的浮点数三元组表示图像像素的 RBG 模式。
- 图像被量化的程度会影响图像的色彩表示，量化的长度成为比特深度(bit depth)，在图片处理中也称为动态范围(dynamic range)。
- 图像被采样的分辨率决定了误差，定义为 DPI (dots per inch) 或者空间像素密度的等效度量。DPI 越高，图像越清晰。

  ![[Pasted image 20240103135337.png]]


## 图像处理

对于图像数据，存在三种运算方式，分别是基于每个像素的点运算、基于区域的邻域运算、基于全局的几何变换。这三种运算对应的方法分别是像素点处理(Point operation)、空间相关性处理(Neighborhood operation)与滤波(filtering)、旋转切变和透视形变等。

### 点算子

一般的图像处理算子是指一个或者多个输入图像到一个输出图像的函数，在连续域中，其可以表示为
$$
g(x) = h(f(x))\quad \text{or}\quad g(x)=h(f_0(x), \dots,f_n(x))
$$
其中 $x$ 属于函数 $D$ 维定义域，而点算子就是直接对像素点进行操作的算子，令 $x=(i, j)$，此时点算子描述为
$$
g(i,j) = h(f(i,j))
$$

伽马矫正 (Gamma-corrected colors) 就是一个点算子，该算子广泛运用于摄像中，其计算方式如下：
$$
corrected=255\times \left(\frac{uncorrected}{255}\right)^{gamma}
$$

### 滤波

邻域算子是利用给定的像素周围的像素的值决定此像素的最终输出值。像素滤波使用的就是邻域算子，实现图像的平滑和锐化、图像边缘的增强或者图像噪声的去除。

#### 线性滤波

线性滤波算子通过不同的权重结合一片小的邻域内的像素。这是一种常用的邻域算子，在深度学习中，CNN 就可以通过多个卷积网络在数据中学习这种算子。线性滤波算子的数学表达如下：
$$
g(i,j) = \sum_{k,l}f(i+k, j+l)h(k,l)
$$
其中权重核或者掩模 $h(k,l)$ 称为滤波系数。上述算子可以简单记为
$$
g=f\otimes h
$$
上式的一个常用变形为
$$
\small g(i,j)=\sum_{k,l}f(i-k, j-l)h(k, l)=\sum_{k,l}f(k,l)h(i-k,j-l)
$$
其中 $f$ 的偏移量的符号反向。该公式又称为卷积，简记为
$$
g=f*h
$$
其中 $h$ 被称为脉冲响应函数。这些实际上是数字信号处理中的概念。一个最简单的例子是 box 滤波器，又称为均方误差滤波器，其定义如下：
$$
g[\cdot, \cdot] =\frac{1}{9}\begin{bmatrix}1&1&1\\1&1&1\\1&1&1\end{bmatrix}
$$

### 卷积

卷积是信号处理中的重要方式。一维卷积方式如下：
$$
(f*g)(x)=\int_{-\infty}^{\infty}f(y)g(x-y)\mathrm{d}y
$$
其中，$f$ 指滤波器函数，$g$ 指滤波信号。卷积的概念可以直观的理解为平移、翻转、叠加。在 2D 离散信号处理中，二维卷积的形式如下：
$$
(f*g)(x,y)=\sum_{i,j=-\infty}^\infty f(i,j)I(x-i,y-j)
$$
其中 $f(i,j)$ 就是我们平时使用的卷积核，或者滤波器。

#### 分离卷积

如果一个二维滤波器的结果可以表示为两个一维滤波器的结果的乘积，那么就称这个滤波器是可分离的滤波器。
$$
xy=\begin{bmatrix}y_1\\y_2\\y_3\end{bmatrix}*\begin{bmatrix}x_1&x_2&x_3\end{bmatrix}=\begin{bmatrix}x_1y_1&x_2y_1 &x_3y_1\\x_1y_2&x_2y_2&x_3y_2\\x_1y_3&x_2y_3&x_3y_3\end{bmatrix}
$$

对于可分离的滤波器，我们可以使用两个一维卷积来替代二维卷积操作，从而将时间复杂度从 $O(M^2N^2)$ 降低到 $O(2NM^2)$。

高斯滤波器就是一个可分离滤波器，它的每一个元素都是使用高斯函数得到的。
$$
f(i,j)=\frac{1}{2\pi\sigma^2}e^{-\frac{i^2+j^2}{2\sigma^2}}
$$
高斯滤波器的权重随着与中心的距离下降，在实际中，我们常常将滤波器的第一个值归一化为 1，得到下面的滤波器近似高斯滤波器：
$$
kernel=\frac{1}{16}\begin{bmatrix}1&2&1\\2&4&2\\1&2&1\end{bmatrix}
$$

#### 其他滤波器

这里给出一些其他的滤波器。

左移操作：
$$
kernel=\begin{bmatrix}0&0&0\\0&0&1\\0&0&0\end{bmatrix}
$$

锐化操作：
$$
kernel=\begin{bmatrix}0&0&0\\0&2&0\\0&0&0\end{bmatrix}-\frac{1}{9}\begin{bmatrix}1&1&1\\1&1&1\\1&1&1\end{bmatrix}
$$
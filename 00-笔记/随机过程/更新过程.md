# 更新过程

对于 Poisson 过程，到达间隔时间是独立同分布的指数[[00-笔记/概率论与数理统计/一维随机变量及其分布|随机变量]]。更新过程是其推广，描述了到达间隔时间是独立同分布的任意随机变量。计数过程$$
\{N(t),t\geqslant0\}
$$定义为**更新过程**，其中$N(t)$是到时间$t$为止的事件数。在更新过程中，我们一般使用独立同分布 $F$ 的随机变量$X_n$表示第$n-1$个事件与第$n$个事件之间的时间，使用 $S_n$ 表示第 $n$ 个事件的到达时间，一般有：$$
S_0=0,\quad S_n=\sum_{i=1}^nX_i,\quad n\geqslant 0
$$此外，为了避免平凡情况，我们假定$F(0)=P\{X_n=0\}<1$，同时使用$$
\mu=E[X_n]=\int_0^\infty x\mathrm dF(x)
$$表示相继事件之间的平均时间，根据假定可以得到$0<\mu\leqslant\infty$。

更新过程中，我们想要回答的第一个问题是，在总量有限的时间内能否有无穷多个事件发生，即对于 $t$ 的某个有限的值，$N(t)$能否是无穷。由强大数定律，在 $n\to\infty$ 时以概率为 1 的有：$$
\frac{S_n}{n}\to\mu
$$由于当$\mu>0$，因此当 $n$ 趋近于无穷大时 $S_n$ 必须无穷大，因此至多只有有限个 $n$ 值使得 $S_n$ 小于或等于 $t$。

##  $N(t)$ 的分布

$N(t)$ 的分布至少在理论上可以得到，为此首先提出一个重要的关系：时刻 $t$ 之前的更新个数大于或等于 $n$ 当且仅当第 $n$ 次更新发生在时刻 $t$ 之前或者时刻 $t$，即$$
N(t)\geqslant n \Leftrightarrow S_n\leqslant t
$$从上式中可以得到$$\begin{aligned}
P\{N(t)=n\}&=P\{N(t)\geqslant n\}-P\{N(t)\geqslant n+1\}\\&=P\{S_n\leqslant t\}-P\{S_{n+1}\leqslant t\}\end{aligned}
$$由于$X_n$ 是独立同分布的变量，由此可以推出 $S_n=\sum_{i=1}^nX_i$ 与 $F_n$ 同分布，于是可以得到$$
P\{N(t)=n\}=F_n(t)-F_{n+1}(t)
$$令$$m(t)=E[N(t)]$$上式称为均值函数，即更新函数，特别的，在到达间隔分布 $F$ 与更新函数之间存在一一对应的关系，更新函数有下面的几个重要结论：
1. $m(t)=\sum_{n=1}^\infty F_n(t)$，因此 $F$ 唯一确定了 $m(t)$
2. 对一切 $0\leqslant t < \infty$ 有 $m(t)<\infty$


## 极限定理

当以 $N(\infty)=\lim_{t\to\infty}N(t)$ 记为发生的更新总数，则易见以概率 1 地有$$
N(\infty)=\infty
$$然而，我们更加关心的是$N(t)$趋于无穷的速率，即我们更想要知道有关 $\lim_{t\to\infty} N(t)/t$ 的情况。

在考虑 $N(t)$ 的增长速率之前，先考虑随机变量$S_{N(t)}$，该随机变量表示在时刻 $t$ 之前后者在时刻 $t$ 时发生的最后一个时间的时间。类似的可以得到$S_{N(t)+1}$ 表示时刻 $t$ 之后发生第一个事件的时刻。

使用上述概念可以证明下面的命题：

在 $t\to\infty$ 时，以概率 1 地有$$
\frac{N(t)}{t}\to\frac{1}{\mu}
$$在上式中，$\frac{1}{\mu}$ 被称为更新过程的速率，由于在更新间隔的平均时间是 $\mu$，显然，每 $\mu$ 个时间单位内发生更新的平均速率为 1。

上述命题说明了当 $t\to\infty$ 时，到时刻 $t$ 的平均更新率以概率 1 收敛到 $1/\mu$，下面考虑平均更新率的期望是什么，这个的结果由基本更新定理给出$$
\frac{m(t)}{t}\to\frac{1}{\mu},\quad t\to\infty
$$
为了证明上面的定理，我们需要使用瓦德尔方程，在介绍瓦德尔方程之前，先对独立随机变量引入停时概念，即：如果对一切 $n=1,2,\cdots$，事件 $\{N=n\}$ 独立于 $X_{n+1},X_{n+2},\cdots$，那么非负整值随机变量 $N$ 对于独立随机变量序列 $X_1,X_2,\cdots$ 称为停时。

停时的意义在于，我们想象 $X_i$ 被依次观察，而 $N$ 表示在停止观前他们被观测的次数，因为我们在观测 $X_1,X_2,\cdots, X_n$ 后停止这一事件指依赖于 $n$ 个值而不依赖于将来的观察值，它必须独立与将来的值。

下面来叙述瓦尔德方程，设 $X_1,X_2,\cdots$ 是独立同分布的随机变量列，具有有限的期望 $E[X]$，而 $N$ 表示此序列的停时，使得$E[N]<\infty$，则$$
E\left[\sum_{n=1}^NX_n\right]=E[N]E[X]
$$若$X_1,X_2,\cdots$是更新过程的到达时间列，则瓦德尔方程有以下推论$$
E[X_1+\cdots+X_{N(t)+1}]=E[X]E[N(t)+1]
$$这个方程就是$$
E[S_{N(t)+1}]=\mu[m(t)+1]
$$现在可以证明基本更新定理。

还有一个重要定理是更新过程中的中心极限定理，它叙述为对于大的 $t$，$N(t)$ 近似于均值为 $t/\mu$ 和方差为 $t\sigma^2/\mu^3$ 的正态分布，其中 $\mu$ 和 $\sigma^2$ 分别是到达间隔分布的均值和方差，即$$
\lim_{t\to\infty}P\left\{\frac{N(t)-t/\mu}{\sqrt{t\sigma^3/\mu^3}}<x\right\}=\frac{1}{\sqrt{2\pi}}\int_{-\infty}^x\mathrm e^{-x^2/2}\mathrm dx
$$此外还可以证明$$
\lim_{t\to\infty}\frac{\mathrm{Var}(N(t))}{t}=\sigma^2/\mu^3
$$

## 关键更新定理

这里先提出格点的定义：一个非负随机变量 $X$，若存在 $d>0$，使$\sum_{n=0}^\infty P(X=nd)=1$，则称 $X$ 是格点的。具有这个性质的最大的 $d$ 称为 $X$ 的周期，若 $X$ 是格点的而且 $F$ 是 $X$ 的分布，则我们称 $F$ 是格点的。

下面叙述 **Blackwell 定理**：
1. 若 $F$ 不是格点的，则对于一切 $a\geqslant0$，在 $t\to\infty$时有$$m(t+a)-m(t)\to a/\mu$$
2. 若 $F$ 具有周期 $d$ 的格点分布，则在 $n\to\infty$ 时有$$E[\text{在nd的更新次数}]\to d/\mu$$

Blackwell 定理说明，若 $F$ 不是格点的，则在远离原点的一个长度为 $a$ 的中的期望更新次数近似为 $a/\mu$，这是非常直观的，因为离原点越远，看起来初始效应会消失。

下面叙述**关键更新定理**：若 $F$ 不是格点分布，且若 $h(t)$ 是直接 Riemann 可积的，则$$\lim_{t\to\infty}\int_0^th(t-x)\mathrm m(x) = \frac{1}{\mu}\int_{0}{t}h(t)\mathrm dt
$$其中$$m(x)=\sum_{n=1}^{\infty}F_n(x)\quad\mu=\int_{0}^\infty\overline F(t)dt$$

关键更新定理与 Balckwell 定理是等价的，关键更新定理是非常重要而有效的结果，它用于计算 $g(t)$ 的极限值，其中 $g(t)$ 是在时刻 $t$ 的某个概率或者期望。我们使用他的方法是，先决条件于早于（或在）$t$ 的最后一次更新的时刻，由此推导出了 $g(t)$ 的一个方程，即$$
g(t)=h(t)+\int_0^th(t-x)\mathrm dm(x)
$$最后可以导出早于 $t$ 的最后一次更新时刻 $S_{N(t)}$ 的分布$$
P\{S_{N(t)}\leqslant s\}=\overline F(t)+\int_0^s\overline F(t-y)\mathrm dm(y)
$$其中$t\geqslant s\geqslant 0$。

### 交替更新过程

考虑一种可以处在开与关状态的系统，初始时处于开状态并且保持一段时间 $Z_1$，然后它转变为关状态后又保持了一段时间 $Y_1$，然后再转变为开状态并保持了一段时间 $Z_2$，然后再转变为关状态并保持了一段时间 $Y_2$，由此继续下去。这就是**交替更新过程**描述的场景。

假设向量 $(X_n,Y_n)$ 独立同分布，因此随机变量序列 $\{Z_n\}$ 和随机变量序列$\{Y_n\}$ 两者分别都是独立同分布的，但是我们允许 $Z_n$ 与 $Y_n$ 是相依的。换句话说，每次在程序转变为开状态时重新开始，但是转变为关状态时允许关状态的时间长度依赖与开状态。令 $H$ 为 $Z_n$ 的分布，$G$ 是 $Y_n$ 的分布，而 $F$ 是 $Z_n+Y_n$ 的分布，进而令$$
P(t)=P\{\text{在时刻 $t$ 系统在开状态}\}$$

于是有定理：若$E[Z_n+Y_n]<\infty$，且 $F$ 不是格点的，那么$$
\lim_{t\to\infty}P(t)=\frac{E[Z_n]}{E[Z_n]+E[Y_n]}$$
上述定理使用关键更新定理可以证明，该定理十分重要，因为很多的系统都可以使用交替更新过程进行建模，例如一个更新过程中，以 $Y(t)$ 记自 $t$ 时刻起到下次更新的时间，以 $A(t)$ 记时刻 $t$ 前的最后一次更新到 $t$ 的时间，即$$
Y(t)=S_{N(t)+1}-t\quad A(t)=t-S_{N(t)}$$其中 $Y(t)$ 称为 $t$ 的**超出量**或**剩余寿命**，$A(t)$ 称为 $t$ 的**年龄**。若到达间隔分布不是格点的，且 $\mu<\infty$，则$$
\lim_{t\to\infty}P\{Y(t)\leqslant x\}=\lim_{t\to\infty}P\{A(t)\leqslant x\}=\int_0^x\overline F(y)\mathrm dy/\mu$$

### 极限平均寿命和$m(t)$的展开

非格点更新过程的平均剩余寿命可以通过取条件于 $S_{N(t)}$ 计算得到，可以证明若到达间隔分布是非格点的，且 $E[X^2]<\infty$，则$$
\lim_{t\to\infty}E[Y(t)]=E[X^2]/2\mu$$现在，在时刻 $t$ 以后首次更新的时间 $S_{N(t)+1}$ 可以表示为$$
S_{N(t)+1}=t+Y(t)$$取期望后可以得到$$
\mu(m(t)+1)=t+E[Y(t)]$$或者$$
m(t)-\frac{t}{\mu}=\frac{E[Y(t)]}{\mu}-1$$于是可以下面的推论：若 $E[X^2]<\infty$，且 $F$ 是非格点的，则在 $t\to\infty$ 时有$$
m(t)-\frac{t}{\mu}\to\frac{E[X^2]}{2\mu^2}-1$$

### 年龄相依的分支过程

假设一个有机体在结束生命时按概率分布产生随机多个后代，进而假设所有的后代都独立的行动，且按同样的概率分布 $\{P_j\}$ 产生各自的后代，最后，假设这些有机体的寿命都是独立随机变量，具有相同的分布。

以 $X(t)$ 记在时刻 $t$ 活着的有机体个数，随机过程 $\{X(t),t\geqslant0\}$ 称为**年龄相依的分支过程**。我们关注的是在 $m=\sum_{j=0}^\infty jP_j>1$ 时，确定 $M(t)=E[X(t)]$ 的渐近形式。可以证明如下定理：若 $X_0=1,m>1$，而 $F$ 不是格点的，则在 $t\to\infty$ 时有$$
e^{-at}M(t)\to\frac{m-1}{m^2\int_0^\infty xe^{-ax}\mathrm dF(x)}
$$其中 $\alpha$ 是唯一的正数，使得$$\int_0^\infty e^{-ax}\mathrm dF(x)=\frac{1}{m}$$

## 延迟更新过程

**延迟更新过程**是更新过程的推广，其首个到达间隔时间与其余的到达间隔时间有着不同的分布，我们将延迟更新过程记为$\{N_D(t),t\geqslant0\}$。延迟更新过程的性质可以类比更新过程，特别的，延迟更新过程的更新函数为$$m_D(t)=\sum_{n=1}^\infty G*F_{n-1}(t)$$对上式进行 Laplace 变换，可以得到$$\widetilde m_D(s)=\frac{\widetilde G(s)}{1-\widetilde F(s)}$$

下面是一些从更新过程的性质中进行的推广，令$\mu=\int_{0}^\infty x\mathrm dF(x)$，有
1. 在 $t\to\infty$ 时，以概率为 1 地有$$\frac{N_D(t)}{t}\to\frac{1}{\mu}$$
2. 在 $t\to\infty$ 时有$$\frac{m_D(t)}{t}\to\frac{1}{\mu}$$
3. 若 $F$ 不是格点的，则在 $t\to\infty$ 时，$$m_D(t+a)-m_D(t)\to\frac{a}{\mu}$$
4. 若 $F$ 和 $G$ 都是格点的，具有周期 $d$，则在 $n\to\infty$ 时$$E[\text{在 $nd$ 的更新数}]\to\frac{d}{\mu}$$
5. 若 $F$ 不是格点的，$\mu<\infty$，且 $h$ 是直接 Riemann 可积的，则在 $t\to\infty$ 时，$$\int_0^\infty h(t-x)\mathrm dm_D(x)\to\int_0^\infty h(t)\mathrm dt/\mu$$

通过与更新过程中相同的定义，可以推出最后一次更新时间的分布为$$P\{S_{N(t)}\leqslant s\}=\overline G(t)+\int_o^s\overline F(t-y)\mathrm dm_D(y)$$当 $\mu<\infty$ 时，分布函数$$
F_e(x)=\int_0^x\overline F(y)\mathrm dy/\mu,\quad x\leqslant 0
$$称为 $F$ 的平衡分布，它的 Laplace 变换为$$\widetilde F_e(s)=\frac{1-\widetilde F(s)}{\mu s}$$具有 $G=F_e$ 的延迟更新过程称为**平衡更新过程**，它极其重要。以 $Y_D(t)$ 记一个延迟更新过程在时间 $t$ 的剩余寿命，则对于平衡更新过程有
1. $m_D(t)=t/\mu$
2. 对一切 $t\geqslant 0$ 有 $P\{Y_D(t)\leqslant x\}=F_e(x)$
3. $\{N_D(t),t\geqslant0\}$ 有平稳增量

## 更新报酬过程

大量的概率模型是下面的这种特殊情形，考虑到达时间 $X_n$ 的更新过程 $\{N(t),t\geqslant0\}$，并且假设每次更新发生时我们接受一个报酬，以 $R_n$ 记在第 $n$ 次更新时得到的报酬，假定 $R_n$ 独立同分布，但是我们仍然允许 $R_n$ 可以依赖于第 $n$ 个更新区间内的长度 $X_n$。如果我们令$$R(t)=\sum_{n=1}^{N(t)}R_n$$那么 $R(t)$ 可以表示到时刻 $t$ 为止赚到的所有报酬，令$$E[R]=E[R_n],\quad E[X]=E[X_n]$$如果 $E[R]<\infty$ 且 $E[X]<\infty$，那么
1. 以概率 1 地，$\lim_{t\to\infty}\frac{R(t)}{t}=\frac{E[R]}{E[X]}$
2. $\lim_{t\to\infty}\frac{E[R(t)]}{t}=\frac{E[R]}{E[X]}$

## 再现过程

考虑状态空间为 $\{0,1,2,···\}$ 的随机过程 $\{X(t),t≥0\}$，它具有如下的性质：存在一些时间点，使过程在这些时刻在概率意义上重新开始。即以概率为 1 地，假设存在一个时刻 $S_1$，使过程在$S_1$后的继续在概率上是从时刻 0 开始的对全过程的复制。注意，此性质蕴含，进一步地存在具有与 $S_1$ 同样性质的时刻 $S_1,S_2···$ 这样的随机过程以再现过程而著名。

​从上推出 $\{S_1,S_2,⋯\}$ 组成一个更新过程的事件发生的时刻。每当一次更新发生时，我们就说完成一个循环，以 $N(t)=\max\{n, Sn\le t\}$ 记直至 $t$ 为止的循环数。

​下述重要定理的证明是关键更新定理威力的进一步显示。若一个循环的分布 $F$ 在某个区间具有密度，且如果 $E[S_1]<\infty$，则$$P_j=\lim \limits_{t \to \infty }P\{X(t)=j\}=\frac{E[一个循环中在状态j的总时间]}{E[一个循环的时间]}.$$

按更新过程到达的排队模型是一个典型的在现过程的例子，多数顾客按更新过程到达的排队过程都是再现过程，其循环开始于每当到达的顾客发现系统空闲的时刻。例如，在按更新过程到达的单条服务线的排队模型中，倘使首个顾客是在$t=0$到达的，则在时刻$t$系统中的人数$X(t)$构成一个再现过程，（若首个顾客不是在$t=0$到达的，则它是一个延迟的再现过程，而定理 3.7.1 保持有效）。

​从更新报酬过程的理论推出，$P_j$也等于$X(t)=j$的时间的长程比例。事实上，我们有下述命题：对一个$E[S_1]<\infty$的再现过程，以概率为 1 地有
$$\lim\limits_{t\to\infty}\frac{[在(0,t)中处在j的总时间]}{t}=\frac{E[一个循环中处在j的时间]}{E[一个循环的时间]}.$$

**对称随即徘徊**

令$Y_1,Y_2,···$独立同分布，具有$$P\{Y_i=1\}=P\{Y_i=-1\}=\frac{1}{2},$$且定义$$Z_0=0,\quad Z_n=\sum^n_{i=1}Y_i.$$过程$\{Z_n,n\ge0\}$称为对称随即徘徊过程。